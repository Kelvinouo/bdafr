--[[VARIABLE DEFINITION ANOMALY DETECTED, DECOMPILATION OUTPUT POTENTIALLY INCORRECT]]--
--[[VARIABLE DEFINITION ANOMALY DETECTED, DECOMPILATION OUTPUT POTENTIALLY INCORRECT]]--
--[[VARIABLE DEFINITION ANOMALY DETECTED, DECOMPILATION OUTPUT POTENTIALLY INCORRECT]]--
--[[VARIABLE DEFINITION ANOMALY DETECTED, DECOMPILATION OUTPUT POTENTIALLY INCORRECT]]--
--[[VARIABLE DEFINITION ANOMALY DETECTED, DECOMPILATION OUTPUT POTENTIALLY INCORRECT]]--
-- Decompiled with the Synapse X Luau decompiler.

local v1 = {};
local u1 = nil;
local function u2(p1, ...)
	u1 = nil;
	p1(...);
	u1 = u1;
end;
local v2 = {};
v2.__index = v2;
local function u3(...)
	u2(...);
	while true do
		u2(coroutine.yield());	
	end;
end;
function v2.Disconnect(p2)
	if p2._is_connected == false then
		return;
	end;
	p2._is_connected = false;
	local l___script_signal__3 = p2._script_signal;
	l___script_signal__3._listener_count = l___script_signal__3._listener_count - 1;
	if p2._script_signal._head == p2 then
		p2._script_signal._head = p2._next;
	else
		local v4 = p2._script_signal._head;
		while v4 ~= nil and v4._next ~= p2 do
			v4 = v4._next;		
		end;
		if v4 ~= nil then
			v4._next = p2._next;
		end;
	end;
	if p2._disconnect_listener ~= nil then
		if not u1 then
			u1 = coroutine.create(u3);
		end;
		task.spawn(u1, p2._disconnect_listener, p2._disconnect_param);
		p2._disconnect_listener = nil;
	end;
end;
local v5 = {};
v5.__index = v5;
function v5.Connect(p3, p4, p5, p6)
	local v6 = {
		_listener = p4, 
		_script_signal = p3, 
		_disconnect_listener = p5, 
		_disconnect_param = p6, 
		_next = p3._head, 
		_is_connected = true
	};
	setmetatable(v6, v2);
	p3._head = v6;
	p3._listener_count = p3._listener_count + 1;
	return v6;
end;
function v5.GetListenerCount(p7)
	return p7._listener_count;
end;
function v5.Fire(p8, ...)
	local v7 = p8._head;
	while v7 ~= nil do
		if v7._is_connected == true then
			if not u1 then
				u1 = coroutine.create(u3);
			end;
			task.spawn(u1, v7._listener, ...);
		end;
		v7 = v7._next;	
	end;
end;
function v5.FireUntil(p9, p10, ...)
	local v8 = p9._head;
	while v8 ~= nil do
		if v8._is_connected == true then
			v8._listener(...);
			if p10() ~= true then
				return;
			end;
		end;
		v8 = v8._next;	
	end;
end;
function v1.NewScriptSignal()
	return {
		_head = nil, 
		_listener_count = 0, 
		Connect = v5.Connect, 
		GetListenerCount = v5.GetListenerCount, 
		Fire = v5.Fire, 
		FireUntil = v5.FireUntil
	};
end;
local v9 = {
	NewScriptSignal = v1.NewScriptSignal, 
	ConnectToOnClose = function(p11, p12)
		if game:GetService("RunService"):IsStudio() == false or p12 == true then
			game:BindToClose(p11);
		end;
	end
};
local v10 = {
	ServiceLocked = false, 
	IssueSignal = v9.NewScriptSignal(), 
	CorruptionSignal = v9.NewScriptSignal(), 
	CriticalState = false, 
	CriticalStateSignal = v9.NewScriptSignal(), 
	ServiceIssueCount = 0, 
	_active_profile_stores = {}, 
	_auto_save_list = {}, 
	_issue_queue = {}, 
	_critical_state_start = 0, 
	_mock_data_store = {}, 
	_user_mock_data_store = {}, 
	_use_mock_data_store = false
};
local l__RunService__11 = game:GetService("RunService");
local function u4(p13)
	local v12 = {};
	for v13, v14 in pairs(p13) do
		if type(v14) == "table" then
			v12[v13] = u4(v14);
		else
			v12[v13] = v14;
		end;
	end;
	return v12;
end;
local function u5(p14, p15)
	for v15, v16 in pairs(p15) do
		if type(v15) == "string" then
			if p14[v15] == nil then
				if type(v16) == "table" then
					p14[v15] = u4(v16);
				else
					p14[v15] = v16;
				end;
			elseif type(p14[v15]) == "table" and type(v16) == "table" then
				u5(p14[v15], v16);
			end;
		end;
	end;
end;
local u6 = {};
local u7 = {
	AutoSaveProfiles = 30, 
	RobloxWriteCooldown = 7, 
	ForceLoadMaxSteps = 8, 
	AssumeDeadSessionLock = 1800, 
	IssueCountForCriticalState = 5, 
	IssueLast = 120, 
	CriticalStateLast = 120, 
	MetaTagsUpdatedValues = {
		ProfileCreateTime = true, 
		SessionLoadCount = true, 
		ActiveSession = true, 
		ForceLoadSession = true, 
		LastUpdate = true
	}
};
local u8 = false;
local l___issue_queue__9 = v10._issue_queue;
local function u10(p16)
	local v17 = tostring(p16.VersionId and 0);
	local v18 = {
		CreatedTime = p16.CreatedTime, 
		UpdatedTime = p16.UpdatedTime, 
		Version = string.rep("0", 16) .. "." .. string.rep("0", 10 - string.len(v17)) .. v17 .. "." .. string.rep("0", 16) .. ".01"
	};
	local u11 = p16.MetaData or {};
	function v18.GetMetadata()
		return u4(u11);
	end;
	local u12 = p16.UserIds or {};
	function v18.GetUserIds()
		return u4(u12);
	end;
	return v18;
end;
local l__PlaceId__13 = game.PlaceId;
local l__JobId__14 = game.JobId;
local function u15(p17, p18, p19, p20, p21)
	local v19 = p17[p18];
	if v19 == nil then
		v19 = {};
		p17[p18] = v19;
	end;
	local v20 = math.floor(os.time() * 1000);
	local v21 = v19[p19];
	local v22 = false;
	if v21 == nil then
		v22 = true;
		if p21 ~= true then
			v21 = {
				Data = nil, 
				CreatedTime = v20, 
				UpdatedTime = v20, 
				VersionId = 0, 
				UserIds = {}, 
				MetaData = {}
			};
			v19[p19] = v21;
		end;
	end;
	local v23, v24, v25 = p20(v21 and v21.Data, v22 == false and u10(v21) or nil);
	if v23 == nil then
		return nil;
	end;
	if v21 ~= nil and p21 ~= true then
		v21.Data = v23;
		v21.UserIds = u4(v24 or {});
		v21.MetaData = u4(v25 or {});
		v21.VersionId = v21.VersionId + 1;
		v21.UpdatedTime = v20;
	end;
	return u4(v23), v21 ~= nil and u10(v21) or nil;
end;
local l___user_mock_data_store__16 = v10._user_mock_data_store;
local u17 = false;
local l___mock_data_store__18 = v10._mock_data_store;
local function u19(p22, p23, p24)
	if u6[p23] == nil then
		u6[p23] = {};
	end;
	if u6[p23][p24] == nil then
		u6[p23][p24] = {
			LastWrite = 0, 
			Queue = {}, 
			CleanupJob = nil
		};
	end;
	local v26 = u6[p23][p24];
	local l__Queue__27 = v26.Queue;
	if v26.CleanupJob ~= nil then
		v26.CleanupJob:Disconnect();
		v26.CleanupJob = nil;
	end;
	if u7.RobloxWriteCooldown < os.clock() - v26.LastWrite and #l__Queue__27 == 0 then
		v26.LastWrite = os.clock();
		return p22();
	end;
	table.insert(l__Queue__27, p22);
	while not (u7.RobloxWriteCooldown < os.clock() - v26.LastWrite) or l__Queue__27[1] ~= p22 do
		task.wait();	
	end;
	table.remove(l__Queue__27, 1);
	v26.LastWrite = os.clock();
	return p22();
end;
local function u20(p25, p26, p27, p28)
	warn("[ProfileService]: DataStore API error " .. string.format("[Store:\"%s\";%sKey:\"%s\"]", p26, p27 ~= nil and string.format("Scope:\"%s\";", p27) or "", p28) .. " - \"" .. tostring(p25) .. "\"");
	table.insert(l___issue_queue__9, os.clock());
	v10.IssueSignal:Fire(tostring(p25), p26, p28);
end;
local l___auto_save_list__21 = v10._auto_save_list;
local u22 = 1;
local u23 = os.clock();
local l___active_profile_stores__24 = v10._active_profile_stores;
local function u25(p29)
	local l___profile_store__28 = p29._profile_store;
	(p29._is_user_mock == true and l___profile_store__28._mock_loaded_profiles or l___profile_store__28._loaded_profiles)[p29._profile_key] = nil;
	if next(l___profile_store__28._loaded_profiles) == nil and next(l___profile_store__28._mock_loaded_profiles) == nil then
		local v29 = table.find(l___active_profile_stores__24, l___profile_store__28);
		if v29 ~= nil then
			table.remove(l___active_profile_stores__24, v29);
		end;
	end;
	local v30 = table.find(l___auto_save_list__21, p29);
	if v30 ~= nil then
		table.remove(l___auto_save_list__21, v30);
		if v30 < u22 then
			u22 = u22 - 1;
		end;
		if l___auto_save_list__21[u22] == nil then
			u22 = 1;
		end;
	end;
	local v31 = nil;
	local v32 = nil;
	local l__ActiveSession__33 = p29.MetaData.ActiveSession;
	if l__ActiveSession__33 ~= nil then
		v31 = l__ActiveSession__33[1];
		v32 = l__ActiveSession__33[2];
	end;
	p29._release_listeners:Fire(v31, v32);
end;
local u26 = 0;
local function u27(p30, p31, p32, p33, p34, p35)
	local u28 = nil;
	local u29 = nil;
	local v34, v35 = pcall(function()
		local v36 = nil;
		v36 = function(p36)
			local v37 = false;
			local v38 = false;
			local v39 = { 0, {} };
			if p36 == nil then
				v37 = true;
			elseif type(p36) ~= "table" then
				v37 = true;
				v38 = true;
			end;
			if type(p36) == "table" then
				if type(p36.Data) == "table" and type(p36.MetaData) == "table" and type(p36.GlobalUpdates) == "table" then
					p36.WasCorrupted = false;
					v39 = p36.GlobalUpdates;
					if p32.ExistingProfileHandle ~= nil then
						p32.ExistingProfileHandle(p36);
					end;
				elseif p36.Data == nil and p36.MetaData == nil and type(p36.GlobalUpdates) == "table" then
					p36.WasCorrupted = false;
					v39 = p36.GlobalUpdates and v39;
					v37 = true;
				else
					v37 = true;
					v38 = true;
				end;
			end;
			if v37 == true then
				p36 = {
					GlobalUpdates = v39
				};
				if p32.MissingProfileHandle ~= nil then
					p32.MissingProfileHandle(p36);
				end;
			end;
			if p32.EditProfile ~= nil then
				p32.EditProfile(p36);
			end;
			if v38 == true then
				p36.WasCorrupted = true;
			end;
			return p36, p36.UserIds, p36.RobloxMetaData;
		end;
		if p33 == true then
			local v40, v41 = u15(l___user_mock_data_store__16, p30._profile_store_lookup, p31, v36, p34);
			u28 = v40;
			u29 = v41;
			task.wait();
			return;
		end;
		if u17 ~= true then
			local v42, v43 = u19(function()
				if p34 ~= true then
					return p30._global_data_store:UpdateAsync(p31, v36);
				end;
				local v44 = nil;
				local v45 = nil;
				if p35 ~= nil then
					local u30 = v44;
					local u31 = v45;
					local v46, v47 = pcall(function()
						local v48, v49 = p30._global_data_store:GetVersionAsync(p31, p35);
						u30 = v48;
						u31 = v49;
					end);
					if v46 == false and type(v47) == "string" and string.find(v47, "not valid") ~= nil then
						warn("[ProfileService]: Passed version argument is not valid; Traceback:\n" .. debug.traceback());
					end;
				else
					local v50, v51 = p30._global_data_store:GetAsync(p31);
					v44 = v50;
					v45 = v51;
				end;
				return v36(v44), v45;
			end, p30._profile_store_lookup, p31);
			u28 = v42;
			u29 = v43;
			return;
		end;
		local v52, v53 = u15(l___mock_data_store__18, p30._profile_store_lookup, p31, v36, p34);
		u28 = v52;
		u29 = v53;
		task.wait();
	end);
	if v34 ~= true or type(u28) ~= "table" then
		u20(v35 ~= nil and v35 or "Undefined error", p30._profile_store_name, p30._profile_store_scope, p31);
		return nil;
	end;
	if u28.WasCorrupted == true and p34 ~= true then
		local l___profile_store_name__54 = p30._profile_store_name;
		local l___profile_store_scope__55 = p30._profile_store_scope;
		warn("[ProfileService]: Resolved profile corruption " .. string.format("[Store:\"%s\";%sKey:\"%s\"]", l___profile_store_name__54, l___profile_store_scope__55 ~= nil and string.format("Scope:\"%s\";", l___profile_store_scope__55) or "", p31));
		v10.CorruptionSignal:Fire(l___profile_store_name__54, p31);
	end;
	return nil, nil;
end;
local function u32(p37, p38, p39)
	local l__GlobalUpdates__56 = p37.GlobalUpdates;
	local l___pending_update_lock__57 = l__GlobalUpdates__56._pending_update_lock;
	local l___pending_update_clear__58 = l__GlobalUpdates__56._pending_update_clear;
	local v59, v60, v61 = ipairs(p39[2]);
	while true do
		v59(v60, v61);
		if not v59 then
			break;
		end;
		local v62 = nil;
		local v63, v64, v65 = ipairs(p38[2]);
		while true do
			v63(v64, v65);
			if not v63 then
				break;
			end;
			v65 = v63;
			if v64[1] == v60[1] then
				v62 = v64;
				break;
			end;		
		end;
		local v66 = false;
		if v62 == nil or v62[2] < v60[2] or v60[3] ~= v62[3] then
			v66 = true;
		end;
		if v66 == true then
			if v60[3] == false then
				local v67 = false;
				local v68, v69, v70 = ipairs(l___pending_update_lock__57);
				while true do
					v68(v69, v70);
					if not v68 then
						break;
					end;
					v70 = v68;
					if v60[1] == v69 then
						v67 = true;
						break;
					end;				
				end;
				if v67 == false then
					l__GlobalUpdates__56._new_active_update_listeners:Fire(v60[1], v60[4]);
				end;
			end;
			if v60[3] == true then
				local v71 = false;
				local v72, v73, v74 = ipairs(l___pending_update_clear__58);
				while true do
					v72(v73, v74);
					if not v72 then
						break;
					end;
					v74 = v72;
					if v60[1] == v73 then
						v71 = true;
						break;
					end;				
				end;
				if v71 == false then
					l__GlobalUpdates__56._new_locked_update_listeners:FireUntil(function()
						return table.find(l___pending_update_clear__58, v60[1]) == nil;
					end, v60[1], v60[4]);
				end;
			end;
		end;	
	end;
end;
local function u33(p40, p41)
	if u6[p40] ~= nil then
		if u6[p40][p41] ~= nil then
			local v75 = u6[p40][p41];
			if v75.CleanupJob == nil then
				local l__Queue__34 = v75.Queue;
				v75.CleanupJob = l__RunService__11.Heartbeat:Connect(function()
					if u7.RobloxWriteCooldown < os.clock() - v75.LastWrite and #l__Queue__34 == 0 then
						v75.CleanupJob:Disconnect();
						if u6[p40] ~= nil then
							u6[p40][p41] = nil;
							if next(u6[p40]) == nil then
								u6[p40] = nil;
							end;
						end;
					end;
				end);
				return;
			end;
		elseif next(u6[p40]) == nil then
			u6[p40] = nil;
		end;
	end;
end;
local v76 = {};
v76.__index = v76;
function v76.GetActiveUpdates(p42)
	local v77 = {};
	local v78, v79, v80 = ipairs(p42._updates_latest[2]);
	while true do
		v78(v79, v80);
		if not v78 then
			break;
		end;
		v80 = v78;
		if v79[3] == false then
			local v81 = false;
			if p42._pending_update_lock ~= nil then
				local v82, v83, v84 = ipairs(p42._pending_update_lock);
				while true do
					v82(v83, v84);
					if not v82 then
						break;
					end;
					v84 = v82;
					if v79[1] == v83 then
						v81 = true;
						break;
					end;				
				end;
			end;
			if v81 == false then
				table.insert(v77, { v79[1], v79[4] });
			end;
		end;	
	end;
	return v77;
end;
function v76.GetLockedUpdates(p43)
	local v85 = {};
	local v86, v87, v88 = ipairs(p43._updates_latest[2]);
	while true do
		v86(v87, v88);
		if not v86 then
			break;
		end;
		v88 = v86;
		if v87[3] == true then
			local v89 = false;
			if p43._pending_update_clear ~= nil then
				local v90, v91, v92 = ipairs(p43._pending_update_clear);
				while true do
					v90(v91, v92);
					if not v90 then
						break;
					end;
					v92 = v90;
					if v87[1] == v91 then
						v89 = true;
						break;
					end;				
				end;
			end;
			if v89 == false then
				table.insert(v85, { v87[1], v87[4] });
			end;
		end;	
	end;
	return v85;
end;
function v76.ListenToNewActiveUpdate(p44, p45)
	if type(p45) ~= "function" then
		error("[ProfileService]: Only a function can be set as listener in GlobalUpdates:ListenToNewActiveUpdate()");
	end;
	if p44._update_handler_mode == true then
		error("[ProfileService]: Can't listen to new global updates in ProfileStore:GlobalUpdateProfileAsync()");
	elseif p44._new_active_update_listeners == nil then
		error("[ProfileService]: Can't listen to new global updates in view mode");
	elseif p44._profile:IsActive() == false then
		return {
			Disconnect = function()

			end
		};
	end;
	return p44._new_active_update_listeners:Connect(p45);
end;
function v76.ListenToNewLockedUpdate(p46, p47)
	if type(p47) ~= "function" then
		error("[ProfileService]: Only a function can be set as listener in GlobalUpdates:ListenToNewLockedUpdate()");
	end;
	if p46._update_handler_mode == true then
		error("[ProfileService]: Can't listen to new global updates in ProfileStore:GlobalUpdateProfileAsync()");
	elseif p46._new_locked_update_listeners == nil then
		error("[ProfileService]: Can't listen to new global updates in view mode");
	elseif p46._profile:IsActive() == false then
		return {
			Disconnect = function()

			end
		};
	end;
	return p46._new_locked_update_listeners:Connect(p47);
end;
function v76.LockActiveUpdate(p48, p49)
	if type(p49) ~= "number" then
		error("[ProfileService]: Invalid update_id");
	end;
	if p48._update_handler_mode == true then
		error("[ProfileService]: Can't lock active global updates in ProfileStore:GlobalUpdateProfileAsync()");
	elseif p48._pending_update_lock == nil then
		error("[ProfileService]: Can't lock active global updates in view mode");
	elseif p48._profile:IsActive() == false then
		error("[ProfileService]: PROFILE EXPIRED - Can't lock active global updates");
	end;
	local v93 = nil;
	local v94, v95, v96 = ipairs(p48._updates_latest[2]);
	while true do
		v94(v95, v96);
		if not v94 then
			break;
		end;
		v96 = v94;
		if v95[1] == p49 then
			v93 = v95;
			break;
		end;	
	end;
	if v93 ~= nil then
		local v97 = false;
		local v98, v99, v100 = ipairs(p48._pending_update_lock);
		while true do
			v98(v99, v100);
			if not v98 then
				break;
			end;
			v100 = v98;
			if p49 == v99 then
				v97 = true;
				break;
			end;		
		end;
		if v97 == false and v93[3] == false then
			table.insert(p48._pending_update_lock, p49);
			return;
		end;
	else
		error("[ProfileService]: Passed non-existant update_id");
	end;
end;
function v76.ClearLockedUpdate(p50, p51)
	if type(p51) ~= "number" then
		error("[ProfileService]: Invalid update_id");
	end;
	if p50._update_handler_mode == true then
		error("[ProfileService]: Can't clear locked global updates in ProfileStore:GlobalUpdateProfileAsync()");
	elseif p50._pending_update_clear == nil then
		error("[ProfileService]: Can't clear locked global updates in view mode");
	elseif p50._profile:IsActive() == false then
		error("[ProfileService]: PROFILE EXPIRED - Can't clear locked global updates");
	end;
	local v101 = nil;
	local v102, v103, v104 = ipairs(p50._updates_latest[2]);
	while true do
		v102(v103, v104);
		if not v102 then
			break;
		end;
		v104 = v102;
		if v103[1] == p51 then
			v101 = v103;
			break;
		end;	
	end;
	if v101 ~= nil then
		local v105 = false;
		local v106, v107, v108 = ipairs(p50._pending_update_clear);
		while true do
			v106(v107, v108);
			if not v106 then
				break;
			end;
			v108 = v106;
			if p51 == v107 then
				v105 = true;
				break;
			end;		
		end;
		if v105 == false and v101[3] == true then
			table.insert(p50._pending_update_clear, p51);
			return;
		end;
	else
		error("[ProfileService]: Passed non-existant update_id");
	end;
end;
function v76.AddActiveUpdate(p52, p53)
	if type(p53) ~= "table" then
		error("[ProfileService]: Invalid update_data");
	end;
	if p52._new_active_update_listeners ~= nil then
		error("[ProfileService]: Can't add active global updates in loaded Profile; Use ProfileStore:GlobalUpdateProfileAsync()");
	elseif p52._update_handler_mode ~= true then
		error("[ProfileService]: Can't add active global updates in view mode; Use ProfileStore:GlobalUpdateProfileAsync()");
	end;
	local l___updates_latest__109 = p52._updates_latest;
	local v110 = l___updates_latest__109[1] + 1;
	l___updates_latest__109[1] = v110;
	table.insert(l___updates_latest__109[2], { v110, 1, false, p53 });
end;
function v76.ChangeActiveUpdate(p54, p55, p56)
	if type(p55) ~= "number" then
		error("[ProfileService]: Invalid update_id");
	end;
	if type(p56) ~= "table" then
		error("[ProfileService]: Invalid update_data");
	end;
	if p54._new_active_update_listeners ~= nil then
		error("[ProfileService]: Can't change active global updates in loaded Profile; Use ProfileStore:GlobalUpdateProfileAsync()");
	elseif p54._update_handler_mode ~= true then
		error("[ProfileService]: Can't change active global updates in view mode; Use ProfileStore:GlobalUpdateProfileAsync()");
	end;
	local v111 = nil;
	local v112, v113, v114 = ipairs(p54._updates_latest[2]);
	while true do
		v112(v113, v114);
		if not v112 then
			break;
		end;
		v114 = v112;
		if p55 == v113[1] then
			v111 = v113;
			break;
		end;	
	end;
	if v111 == nil then
		error("[ProfileService]: Passed non-existant update_id");
		return;
	end;
	if v111[3] == true then
		error("[ProfileService]: Can't change locked global update");
	end;
	v111[2] = v111[2] + 1;
	v111[4] = p56;
end;
function v76.ClearActiveUpdate(p57, p58)
	if type(p58) ~= "number" then
		error("[ProfileService]: Invalid update_id argument");
	end;
	if p57._new_active_update_listeners ~= nil then
		error("[ProfileService]: Can't clear active global updates in loaded Profile; Use ProfileStore:GlobalUpdateProfileAsync()");
	elseif p57._update_handler_mode ~= true then
		error("[ProfileService]: Can't clear active global updates in view mode; Use ProfileStore:GlobalUpdateProfileAsync()");
	end;
	local l___updates_latest__115 = p57._updates_latest;
	local v116 = nil;
	local v117 = nil;
	local v118, v119, v120 = ipairs(l___updates_latest__115[2]);
	while true do
		v118(v119, v120);
		if not v118 then
			break;
		end;
		v120 = v118;
		if p58 == v119[1] then
			v116 = v118;
			v117 = v119;
			break;
		end;	
	end;
	if v117 == nil then
		error("[ProfileService]: Passed non-existant update_id");
		return;
	end;
	if v117[3] == true then
		error("[ProfileService]: Can't clear locked global update");
	end;
	table.remove(l___updates_latest__115[2], v116);
end;
local v121 = {};
v121.__index = v121;
function v121.IsActive(p59)
	return (p59._is_user_mock == true and p59._profile_store._mock_loaded_profiles or p59._profile_store._loaded_profiles)[p59._profile_key] == p59;
end;
function v121.GetMetaTag(p60, p61)
	if p60.MetaData == nil then
		return nil;
	end;
	return p60.MetaData.MetaTags[p61];
end;
function v121.SetMetaTag(p62, p63, p64)
	if type(p63) ~= "string" then
		error("[ProfileService]: tag_name must be a string");
	elseif string.len(p63) == 0 then
		error("[ProfileService]: Invalid tag_name");
	end;
	p62.MetaData.MetaTags[p63] = p64;
end;
function v121.Reconcile(p65)
	u5(p65.Data, p65._profile_store._profile_template);
end;
function v121.ListenToRelease(p66, p67)
	if type(p67) ~= "function" then
		error("[ProfileService]: Only a function can be set as listener in Profile:ListenToRelease()");
	end;
	if p66._view_mode == true then
		return {
			Disconnect = function()

			end
		};
	end;
	if p66:IsActive() ~= false then
		return p66._release_listeners:Connect(p67);
	end;
	local v122 = nil;
	local v123 = nil;
	local l__ActiveSession__124 = p66.MetaData.ActiveSession;
	if l__ActiveSession__124 ~= nil then
		v122 = l__ActiveSession__124[1];
		v123 = l__ActiveSession__124[2];
	end;
	p67(v122, v123);
	return {
		Disconnect = function()

		end
	};
end;
local function u35(p68, p69, p70)
	if type(p68.Data) ~= "table" then
		local l___profile_store_name__125 = p68._profile_store._profile_store_name;
		local l___profile_store_scope__126 = p68._profile_store._profile_store_scope;
		local l___profile_key__127 = p68._profile_key;
		warn("[ProfileService]: Resolved profile corruption " .. string.format("[Store:\"%s\";%sKey:\"%s\"]", l___profile_store_name__125, l___profile_store_scope__126 ~= nil and string.format("Scope:\"%s\";", l___profile_store_scope__126) or "", l___profile_key__127));
		v10.CorruptionSignal:Fire(l___profile_store_name__125, l___profile_key__127);
		error("[ProfileService]: PROFILE DATA CORRUPTED DURING RUNTIME! Profile: " .. p68:Identify());
	end;
	if p69 == true and p70 ~= true then
		u25(p68);
	end;
	u26 = u26 + 1;
	local l__SessionLoadCount__128 = p68.MetaData.SessionLoadCount;
	local v129 = true;
	while v129 == true do
		if p69 ~= true then
			v129 = false;
		end;
		local v130 = {
			ExistingProfileHandle = nil, 
			MissingProfileHandle = nil
		};
		function v130.EditProfile(p71)
			local v131 = false;
			local v132 = false;
			if p70 ~= true then
				local l__ActiveSession__133 = p71.MetaData.ActiveSession;
				local l__ForceLoadSession__134 = p71.MetaData.ForceLoadSession;
				if type(l__ActiveSession__133) == "table" then
					local v135 = false;
					if l__ActiveSession__133[1] == l__PlaceId__13 then
						v135 = l__ActiveSession__133[2] == l__JobId__14;
					end;
					if v135 then
						v135 = p71.MetaData.SessionLoadCount == l__SessionLoadCount__128;
					end;
					v131 = v135;
				end;
				if type(l__ForceLoadSession__134) == "table" then
					local v136 = false;
					if l__ForceLoadSession__134[1] == l__PlaceId__13 then
						v136 = l__ForceLoadSession__134[2] == l__JobId__14;
					end;
					v132 = not v136;
				end;
			else
				v131 = true;
			end;
			if v131 == true then
				if p70 ~= true then
					local v137 = p71.GlobalUpdates[2];
					local l__GlobalUpdates__138 = p68.GlobalUpdates;
					local l___pending_update_lock__139 = l__GlobalUpdates__138._pending_update_lock;
					for v140 = 1, #v137 do
						local v141, v142, v143 = ipairs(l___pending_update_lock__139);
						while true do
							v141(v142, v143);
							if not v141 then
								break;
							end;
							v143 = v141;
							if v137[v140][1] == v142 then
								v137[v140][3] = true;
								break;
							end;						
						end;
					end;
					local v144, v145, v146 = ipairs(l__GlobalUpdates__138._pending_update_clear);
					while true do
						v144(v145, v146);
						if not v144 then
							break;
						end;
						for v147 = 1, #v137 do
							if v137[v147][1] == v145 and v137[v147][3] == true then
								table.remove(v137, v147);
								break;
							end;
						end;					
					end;
				end;
				p71.Data = p68.Data;
				p71.RobloxMetaData = p68.RobloxMetaData;
				p71.UserIds = p68.UserIds;
				if p70 ~= true then
					p71.MetaData.MetaTags = p68.MetaData.MetaTags;
					p71.MetaData.LastUpdate = os.time();
					if p69 == true or v132 == true then
						p71.MetaData.ActiveSession = nil;
						return;
					end;
				else
					p71.MetaData = p68.MetaData;
					p71.MetaData.ActiveSession = nil;
					p71.MetaData.ForceLoadSession = nil;
					p71.GlobalUpdates = p68.GlobalUpdates._updates_latest;
				end;
			end;
		end;
		local v148, v149 = u27(p68._profile_store, p68._profile_key, v130, p68._is_user_mock);
		if v148 ~= nil and v149 ~= nil then
			local v150 = nil;
			if p70 == true then
				break;
			end;
			p68.KeyInfo = v149;
			local l__GlobalUpdates__151 = p68.GlobalUpdates;
			local l__GlobalUpdates__152 = v148.GlobalUpdates;
			l__GlobalUpdates__151._updates_latest = l__GlobalUpdates__152;
			local l__MetaData__153 = p68.MetaData;
			local l__MetaData__154 = v148.MetaData;
			for v155 in pairs(u7.MetaTagsUpdatedValues) do
				l__MetaData__153[v155] = l__MetaData__154[v155];
			end;
			l__MetaData__153.MetaTagsLatest = l__MetaData__154.MetaTags;
			local l__ActiveSession__156 = v148.MetaData.ActiveSession;
			local v157 = false;
			if type(l__ActiveSession__156) == "table" then
				local v158 = false;
				if l__ActiveSession__156[1] == l__PlaceId__13 then
					v158 = l__ActiveSession__156[2] == l__JobId__14;
				end;
				if v158 then
					v158 = v148.MetaData.SessionLoadCount == l__SessionLoadCount__128;
				end;
				v157 = v158;
			end;
			v150 = p68:IsActive();
			if v157 == true then
				if v150 == true then
					u32(p68, l__GlobalUpdates__151._updates_latest, l__GlobalUpdates__152);
				end;
			else
				if v150 == true then
					u25(p68);
				end;
				u33(p68._profile_store._profile_store_lookup, p68._profile_key);
				if p68._hop_ready == false then
					p68._hop_ready = true;
					p68._hop_ready_listeners:Fire();
				end;
			end;
			p68.MetaTagsUpdated:Fire(p68.MetaData.MetaTagsLatest);
			p68.KeyInfoUpdated:Fire(v149);
		elseif v129 == true then
			task.wait();
		end;	
	end;
	u26 = u26 - 1;
end;
function v121.Save(p72)
	if p72._view_mode == true then
		error("[ProfileService]: Can't save Profile in view mode - Should you be calling :OverwriteAsync() instead?");
	end;
	if p72:IsActive() == false then
		warn("[ProfileService]: Attempted saving an inactive profile " .. p72:Identify() .. "; Traceback:\n" .. debug.traceback());
		return;
	end;
	local v159 = u6[p72._profile_store._profile_store_lookup];
	if v159 ~= nil then
		local v160 = v159[p72._profile_key];
		local v161 = true;
		if v160 ~= nil then
			v161 = #v160.Queue == 0;
		end;
	else
		v161 = true;
	end;
	if v161 == true then
		local v162 = table.find(l___auto_save_list__21, p72);
		if v162 ~= nil then
			table.remove(l___auto_save_list__21, v162);
			if v162 < u22 then
				u22 = u22 - 1;
			end;
			if l___auto_save_list__21[u22] == nil then
				u22 = 1;
			end;
		end;
		table.insert(l___auto_save_list__21, u22, p72);
		if #l___auto_save_list__21 > 1 then
			u22 = u22 + 1;
		elseif #l___auto_save_list__21 == 1 then
			u23 = os.clock();
		end;
		task.spawn(u35, p72);
	end;
end;
function v121.Release(p73)
	if p73._view_mode == true then
		return;
	end;
	if p73:IsActive() == true then
		task.spawn(u35, p73, true);
	end;
end;
function v121.ListenToHopReady(p74, p75)
	if type(p75) ~= "function" then
		error("[ProfileService]: Only a function can be set as listener in Profile:ListenToHopReady()");
	end;
	if p74._view_mode == true then
		return {
			Disconnect = function()

			end
		};
	end;
	if p74._hop_ready == true then
		task.spawn(p75);
		return {
			Disconnect = function()

			end
		};
	end;
	return p74._hop_ready_listeners:Connect(p75);
end;
function v121.AddUserId(p76, p77)
	if type(p77) ~= "number" or p77 % 1 ~= 0 then
		warn("[ProfileService]: Invalid UserId argument for :AddUserId() (" .. tostring(p77) .. "); Traceback:\n" .. debug.traceback());
		return;
	end;
	if p77 < 0 and p76._is_user_mock ~= true and u17 ~= true then
		return;
	end;
	if table.find(p76.UserIds, p77) == nil then
		table.insert(p76.UserIds, p77);
	end;
end;
function v121.RemoveUserId(p78, p79)
	if type(p79) ~= "number" or p79 % 1 ~= 0 then
		warn("[ProfileService]: Invalid UserId argument for :RemoveUserId() (" .. tostring(p79) .. "); Traceback:\n" .. debug.traceback());
		return;
	end;
	local v163 = table.find(p78.UserIds, p79);
	if v163 ~= nil then
		table.remove(p78.UserIds, v163);
	end;
end;
local function u36(p80, p81, p82)
	return string.format("[Store:\"%s\";%sKey:\"%s\"]", p80, p81 ~= nil and string.format("Scope:\"%s\";", p81) or "", p82);
end;
function v121.Identify(p83)
	return u36(p83._profile_store._profile_store_name, p83._profile_store._profile_store_scope, p83._profile_key);
end;
function v121.ClearGlobalUpdates(p84)
	if p84._view_mode ~= true then
		error("[ProfileService]: :ClearGlobalUpdates() can only be used in view mode");
	end;
	local v164 = {
		_updates_latest = { 0, {} }, 
		_profile = p84
	};
	setmetatable(v164, v76);
	p84.GlobalUpdates = v164;
end;
function v121.OverwriteAsync(p85)
	if p85._view_mode ~= true then
		error("[ProfileService]: :OverwriteAsync() can only be used in view mode");
	end;
	u35(p85, nil, true);
end;
local v165 = {};
v165.__index = v165;
function v165._MoveQueue(p86)
	while #p86._query_queue > 0 do
		task.spawn((table.remove(p86._query_queue, 1)));
		if p86._is_query_yielded == true then
			break;
		end;	
	end;
end;
function v165.NextAsync(p87, p88)
	local v166 = nil;
	if p87._profile_store == nil then
		return nil;
	end;
	local u37 = false;
	local u38 = nil;
	v166 = function()
		if p87._query_failure == true then
			u37 = true;
			return;
		end;
		if p87._query_pages == nil then
			p87._is_query_yielded = true;
			task.spawn(function()
				u38 = p87:NextAsync(true);
				u37 = true;
			end);
			local v167, v168 = pcall(function()
				p87._query_pages = p87._profile_store._global_data_store:ListVersionsAsync(p87._profile_key, p87._sort_direction, p87._min_date, p87._max_date);
				p87._query_index = 0;
			end);
			if v167 == false or p87._query_pages == nil then
				warn("[ProfileService]: Version query fail - " .. tostring(v168));
				p87._query_failure = true;
			end;
			p87._is_query_yielded = false;
			p87:_MoveQueue();
			return;
		end;
		local v169 = p87._query_pages:GetCurrentPage()[p87._query_index + 1];
		if p87._query_pages.IsFinished == true and v169 == nil then
			u37 = true;
			return;
		end;
		if v169 ~= nil then
			p87._query_index = p87._query_index + 1;
			u38 = p87._profile_store:ViewProfileAsync(p87._profile_key, v169.Version);
			u37 = true;
			return;
		end;
		p87._is_query_yielded = true;
		task.spawn(function()
			u38 = p87:NextAsync(true);
			u37 = true;
		end);
		if pcall(function()
			p87._query_pages:AdvanceToNextPageAsync();
			p87._query_index = 0;
		end) == false or #p87._query_pages:GetCurrentPage() == 0 then
			p87._query_failure = true;
		end;
		p87._is_query_yielded = false;
		p87:_MoveQueue();
	end;
	if p87._is_query_yielded == false then
		v166();
	elseif p88 == true then
		table.insert(p87._query_queue, 1, v166);
	else
		table.insert(p87._query_queue, v166);
	end;
	while u37 == false do
		task.wait();	
	end;
	return nil;
end;
local v170 = {};
v170.__index = v170;
local u39 = {};
local u40 = 0;
local u41 = 0;
function v170.LoadProfileAsync(p89, p90, p91, p92)
	p91 = p91 and "ForceLoad";
	if p89._profile_template == nil then
		error("[ProfileService]: Profile template not set - ProfileStore:LoadProfileAsync() locked for this ProfileStore");
	end;
	if type(p90) ~= "string" then
		error("[ProfileService]: profile_key must be a string");
	elseif string.len(p90) == 0 then
		error("[ProfileService]: Invalid profile_key");
	end;
	if type(p91) ~= "function" and p91 ~= "ForceLoad" and p91 ~= "Steal" then
		error("[ProfileService]: Invalid not_released_handler");
	end;
	if v10.ServiceLocked == true then
		return nil;
	end;
	while p89._is_pending == true do
		task.wait();	
	end;
	local v171 = p92 == u39;
	local v172, v173, v174 = ipairs(l___active_profile_stores__24);
	while true do
		v172(v173, v174);
		if not v172 then
			break;
		end;
		v174 = v172;
		if v173._profile_store_lookup == p89._profile_store_lookup and (v171 == true and v173._mock_loaded_profiles or v173._loaded_profiles)[p90] ~= nil then
			local l___profile_store_scope__175 = p89._profile_store_scope;
			error("[ProfileService]: Profile " .. string.format("[Store:\"%s\";%sKey:\"%s\"]", p89._profile_store_name, l___profile_store_scope__175 ~= nil and string.format("Scope:\"%s\";", l___profile_store_scope__175) or "", p90) .. " is already loaded in this session");
		end;	
	end;
	u40 = u40 + 1;
	local v176 = p91 == "ForceLoad";
	local v177 = 0;
	local v178 = false;
	local v179 = p91 == "Steal";
	while v10.ServiceLocked == false do
		local v180 = v171 == true and p89._mock_profile_load_jobs or p89._profile_load_jobs;
		local v181 = u41 + 1;
		u41 = v181;
		local v182 = v180[p90];
		if v182 ~= nil then
			v182[1] = v181;
			while v182[2] == nil do
				task.wait();			
			end;
			if v182[1] ~= v181 then
				u40 = u40 - 1;
				return nil;
			end;
			local v183, v184 = table.unpack(v182[2]);
			local v185 = v183;
			local v186 = v184;
			v180[p90] = nil;
		else
			local v187 = { v181, nil };
			v180[p90] = v187;
			local v188 = {};
			function v188.ExistingProfileHandle(p93)
				if v10.ServiceLocked == false then
					local l__ActiveSession__189 = p93.MetaData.ActiveSession;
					local l__ForceLoadSession__190 = p93.MetaData.ForceLoadSession;
					if l__ActiveSession__189 == nil then
						p93.MetaData.ActiveSession = { l__PlaceId__13, l__JobId__14 };
						p93.MetaData.ForceLoadSession = nil;
						return;
					end;
					if type(l__ActiveSession__189) == "table" then
						local v191 = false;
						if l__ActiveSession__189[1] == l__PlaceId__13 then
							v191 = l__ActiveSession__189[2] == l__JobId__14;
						end;
						if v191 == false then
							local l__LastUpdate__192 = p93.MetaData.LastUpdate;
							if l__LastUpdate__192 ~= nil and u7.AssumeDeadSessionLock < os.time() - l__LastUpdate__192 then
								p93.MetaData.ActiveSession = { l__PlaceId__13, l__JobId__14 };
								p93.MetaData.ForceLoadSession = nil;
								return;
							end;
							if v178 == true or v179 == true then
								local v193 = false;
								if l__ForceLoadSession__190 ~= nil then
									v193 = false;
									if l__ForceLoadSession__190[1] == l__PlaceId__13 then
										v193 = l__ForceLoadSession__190[2] == l__JobId__14;
									end;
								end;
								if v193 == true or v179 == true then
									p93.MetaData.ActiveSession = { l__PlaceId__13, l__JobId__14 };
									p93.MetaData.ForceLoadSession = nil;
									return;
								end;
							elseif v176 == true then
								p93.MetaData.ForceLoadSession = { l__PlaceId__13, l__JobId__14 };
								return;
							end;
						else
							p93.MetaData.ForceLoadSession = nil;
						end;
					end;
				end;
			end;
			function v188.MissingProfileHandle(p94)
				p94.Data = u4(p89._profile_template);
				p94.MetaData = {
					ProfileCreateTime = os.time(), 
					SessionLoadCount = 0, 
					ActiveSession = { l__PlaceId__13, l__JobId__14 }, 
					ForceLoadSession = nil, 
					MetaTags = {}
				};
			end;
			function v188.EditProfile(p95)
				if v10.ServiceLocked == false then
					local l__ActiveSession__194 = p95.MetaData.ActiveSession;
					if l__ActiveSession__194 ~= nil then
						local v195 = false;
						if l__ActiveSession__194[1] == l__PlaceId__13 then
							v195 = l__ActiveSession__194[2] == l__JobId__14;
						end;
						if v195 == true then
							p95.MetaData.SessionLoadCount = p95.MetaData.SessionLoadCount + 1;
							p95.MetaData.LastUpdate = os.time();
						end;
					end;
				end;
			end;
			v187[2] = table.pack(u27(p89, p90, v188, v171));
			if v187[1] ~= v181 then
				u40 = u40 - 1;
				return nil;
			end;
			local v196, v197 = table.unpack(v187[2]);
			v185 = v196;
			v186 = v197;
			v180[p90] = nil;
		end;
		if v185 ~= nil and v186 ~= nil then
			local l__ActiveSession__198 = v185.MetaData.ActiveSession;
			if type(l__ActiveSession__198) ~= "table" then
				u40 = u40 - 1;
				return nil;
			end;
			local v199 = false;
			if l__ActiveSession__198[1] == l__PlaceId__13 then
				v199 = l__ActiveSession__198[2] == l__JobId__14;
			end;
			if v199 == true then
				v185.MetaData.MetaTagsLatest = u4(v185.MetaData.MetaTags);
				local v200 = {
					_updates_latest = v185.GlobalUpdates, 
					_pending_update_lock = {}, 
					_pending_update_clear = {}, 
					_new_active_update_listeners = v9.NewScriptSignal(), 
					_new_locked_update_listeners = v9.NewScriptSignal(), 
					_profile = nil
				};
				setmetatable(v200, v76);
				local v201 = {
					Data = v185.Data, 
					MetaData = v185.MetaData, 
					MetaTagsUpdated = v9.NewScriptSignal(), 
					RobloxMetaData = v185.RobloxMetaData or {}, 
					UserIds = v185.UserIds or {}, 
					KeyInfo = v186, 
					KeyInfoUpdated = v9.NewScriptSignal(), 
					GlobalUpdates = v200, 
					_profile_store = local v202, 
					_profile_key = p90, 
					_release_listeners = v9.NewScriptSignal(), 
					_hop_ready_listeners = v9.NewScriptSignal(), 
					_hop_ready = false, 
					_load_timestamp = os.clock(), 
					_is_user_mock = v171
				};
				setmetatable(v201, v121);
				v200._profile = v201;
				if next(v202._loaded_profiles) == nil and next(v202._mock_loaded_profiles) == nil then
					table.insert(l___active_profile_stores__24, v202);
				end;
				if v171 == true then
					v202._mock_loaded_profiles[p90] = v201;
				else
					v202._loaded_profiles[p90] = v201;
				end;
				table.insert(l___auto_save_list__21, u22, v201);
				if #l___auto_save_list__21 > 1 then
					u22 = u22 + 1;
				elseif #l___auto_save_list__21 == 1 then
					u23 = os.clock();
				end;
				if v10.ServiceLocked == true then
					u35(v201, true);
					v201 = nil;
				end;
				u40 = u40 - 1;
				return v201;
			end;
			if v176 == true then
				local l__ForceLoadSession__203 = v185.MetaData.ForceLoadSession;
				local v204 = false;
				if l__ForceLoadSession__203 ~= nil then
					v204 = false;
					if l__ForceLoadSession__203[1] == l__PlaceId__13 then
						v204 = l__ForceLoadSession__203[2] == l__JobId__14;
					end;
				end;
				if v204 ~= true then
					u40 = u40 - 1;
					return nil;
				end;
				if local v205 == false then
					v177 = v177 + 1;
					if v177 == u7.ForceLoadMaxSteps then

					end;
				end;
				task.wait();
				v205 = false;
			elseif local v206 == true then
				task.wait();
			else
				local v207 = p91(l__ActiveSession__198[1], l__ActiveSession__198[2]);
				if v207 == "Repeat" then
					task.wait();
				else
					if v207 == "Cancel" then
						u40 = u40 - 1;
						return nil;
					end;
					if v207 == "ForceLoad" then
						v176 = true;
						v205 = true;
						task.wait();
					elseif v207 == "Steal" then
						task.wait();
					else
						local l___profile_store_scope__208 = v202._profile_store_scope;
						error("[ProfileService]: Invalid return from not_released_handler (\"" .. tostring(v207) .. "\")(" .. type(v207) .. ");" .. "\n" .. string.format("[Store:\"%s\";%sKey:\"%s\"]", v202._profile_store_name, l___profile_store_scope__208 ~= nil and string.format("Scope:\"%s\";", l___profile_store_scope__208) or "", p90) .. " Traceback:\n" .. debug.traceback());
					end;
				end;
			end;
		else
			task.wait();
		end;	
	end;
	u40 = u40 - 1;
	return nil;
end;
function v170.GlobalUpdateProfileAsync(p96, p97, p98, p99)
	if type(p97) ~= "string" or string.len(p97) == 0 then
		error("[ProfileService]: Invalid profile_key");
	end;
	if type(p98) ~= "function" then
		error("[ProfileService]: Invalid update_handler");
	end;
	if v10.ServiceLocked == true then
		return nil;
	end;
	while p96._is_pending == true do
		task.wait();	
	end;
	while v10.ServiceLocked == false do
		local v209 = {
			ExistingProfileHandle = nil, 
			MissingProfileHandle = nil
		};
		function v209.EditProfile(p100)
			local v210 = {
				_updates_latest = p100.GlobalUpdates, 
				_update_handler_mode = true
			};
			setmetatable(v210, v76);
			p98(v210);
		end;
		local v211 = u27(p96, p97, v209, p99 == u39);
		u33(p96._profile_store_lookup, p97);
		if v211 ~= nil then
			local v212 = {
				_updates_latest = v211.GlobalUpdates
			};
			setmetatable(v212, v76);
			return v212;
		end;
		task.wait();	
	end;
	return nil;
end;
function v170.ViewProfileAsync(p101, p102, p103, p104)
	if type(p102) ~= "string" or string.len(p102) == 0 then
		error("[ProfileService]: Invalid profile_key");
	end;
	if v10.ServiceLocked == true then
		return nil;
	end;
	while p101._is_pending == true do
		task.wait();	
	end;
	if p103 ~= nil and (p104 == u39 or u17 == true) then
		return nil;
	end;
	while v10.ServiceLocked == false do
		local v213 = {
			ExistingProfileHandle = nil
		};
		function v213.MissingProfileHandle(p105)
			p105.Data = u4(p101._profile_template);
			p105.MetaData = {
				ProfileCreateTime = os.time(), 
				SessionLoadCount = 0, 
				ActiveSession = nil, 
				ForceLoadSession = nil, 
				MetaTags = {}
			};
		end;
		v213.EditProfile = nil;
		local v214, v215 = u27(p101, p102, v213, p104 == u39, true, p103);
		u33(p101._profile_store_lookup, p102);
		if v214 ~= nil then
			if v215 == nil then
				return nil;
			else
				local v216 = {
					_updates_latest = v214.GlobalUpdates, 
					_profile = nil
				};
				setmetatable(v216, v76);
				local v217 = {
					Data = v214.Data, 
					MetaData = v214.MetaData, 
					MetaTagsUpdated = v9.NewScriptSignal(), 
					RobloxMetaData = v214.RobloxMetaData or {}, 
					UserIds = v214.UserIds or {}, 
					KeyInfo = v215, 
					KeyInfoUpdated = v9.NewScriptSignal(), 
					GlobalUpdates = v216, 
					_profile_store = p101, 
					_profile_key = p102, 
					_view_mode = true, 
					_load_timestamp = os.clock()
				};
				setmetatable(v217, v121);
				v216._profile = v217;
				return v217;
			end;
		end;
		task.wait();	
	end;
	return nil;
end;
function v170.ProfileVersionQuery(p106, p107, p108, p109, p110, p111)
	if type(p107) ~= "string" or string.len(p107) == 0 then
		error("[ProfileService]: Invalid profile_key");
	end;
	if v10.ServiceLocked == true then
		return setmetatable({}, v165);
	end;
	while p106._is_pending == true do
		task.wait();	
	end;
	if p111 == u39 or u17 == true then
		error("[ProfileService]: :ProfileVersionQuery() is not supported in mock mode");
	end;
	if p108 ~= nil and (typeof(p108) ~= "EnumItem" or p108.EnumType ~= Enum.SortDirection) then
		error("[ProfileService]: Invalid sort_direction (" .. tostring(p108) .. ")");
	end;
	if p109 ~= nil and typeof(p109) ~= "DateTime" and typeof(p109) ~= "number" then
		error("[ProfileService]: Invalid min_date (" .. tostring(p109) .. ")");
	end;
	if p110 ~= nil and typeof(p110) ~= "DateTime" and typeof(p110) ~= "number" then
		error("[ProfileService]: Invalid max_date (" .. tostring(p110) .. ")");
	end;
	p109 = typeof(p109) == "DateTime" and p109.UnixTimestampMillis or p109;
	p110 = typeof(p110) == "DateTime" and p110.UnixTimestampMillis or p110;
	local v218 = {
		_profile_store = p106, 
		_profile_key = p107, 
		_sort_direction = p108, 
		_min_date = p109, 
		_max_date = p110, 
		_query_pages = nil, 
		_query_index = 0, 
		_query_failure = false, 
		_is_query_yielded = false, 
		_query_queue = {}
	};
	setmetatable(v218, v165);
	return v218;
end;
function v170.WipeProfileAsync(p112, p113, p114)
	if type(p113) ~= "string" or string.len(p113) == 0 then
		error("[ProfileService]: Invalid profile_key");
	end;
	if v10.ServiceLocked == true then
		return false;
	end;
	while p112._is_pending == true do
		task.wait();	
	end;
	if p114 == u39 then
		local v219 = l___user_mock_data_store__16[p112._profile_store_lookup];
		if v219 ~= nil then
			v219[p113] = nil;
		end;
		local v220 = true;
		task.wait();
	elseif u17 == true then
		local v221 = l___mock_data_store__18[p112._profile_store_lookup];
		if v221 ~= nil then
			v221[p113] = nil;
		end;
		v220 = true;
		task.wait();
	else
		v220 = pcall(function()
			p112._global_data_store:RemoveAsync(p113);
		end);
	end;
	u33(p112._profile_store_lookup, p113);
	return v220;
end;
local l__DataStoreService__42 = game:GetService("DataStoreService");
function v10.GetProfileStore(p115, p116)
	local v222 = nil;
	local v223 = nil;
	if type(p115) == "string" then
		v222 = p115;
	elseif type(p115) == "table" then
		v222 = p115.Name;
		v223 = p115.Scope;
	else
		error("[ProfileService]: Invalid or missing profile_store_index");
	end;
	if v222 == nil or type(v222) ~= "string" then
		error("[ProfileService]: Missing or invalid \"Name\" parameter");
	elseif string.len(v222) == 0 then
		error("[ProfileService]: ProfileStore name cannot be an empty string");
	end;
	if v223 ~= nil and (type(v223) ~= "string" or string.len(v223) == 0) then
		error("[ProfileService]: Invalid \"Scope\" parameter");
	end;
	if type(p116) ~= "table" then
		error("[ProfileService]: Invalid profile_template");
	end;
	local v224 = {};
	local v225 = {};
	local u43 = nil;
	function v225.LoadProfileAsync(p117, p118, p119)
		return u43:LoadProfileAsync(p118, p119, u39);
	end;
	function v225.GlobalUpdateProfileAsync(p120, p121, p122)
		return u43:GlobalUpdateProfileAsync(p121, p122, u39);
	end;
	function v225.ViewProfileAsync(p123, p124, p125)
		return u43:ViewProfileAsync(p124, p125, u39);
	end;
	function v225.FindProfileVersionAsync(p126, p127, p128, p129, p130)
		return u43:FindProfileVersionAsync(p127, p128, p129, p130, u39);
	end;
	function v225.WipeProfileAsync(p131, p132)
		return u43:WipeProfileAsync(p132, u39);
	end;
	v224.Mock = v225;
	v224._profile_store_name = v222;
	v224._profile_store_scope = v223;
	v224._profile_store_lookup = v222 .. "\000" .. (v223 and "");
	v224._profile_template = p116;
	v224._global_data_store = nil;
	v224._loaded_profiles = {};
	v224._profile_load_jobs = {};
	v224._mock_loaded_profiles = {};
	v224._mock_profile_load_jobs = {};
	v224._is_pending = false;
	u43 = v224;
	setmetatable(u43, v170);
	local v226 = Instance.new("DataStoreOptions");
	v226:SetExperimentalFeatures({
		v2 = true
	});
	if u8 == true then
		u43._is_pending = true;
		task.spawn(function()
			while u8 == true do
				task.wait();			
			end;
			if u17 == false then
				u43._global_data_store = l__DataStoreService__42:GetDataStore(v222, v223, v226);
			end;
			u43._is_pending = false;
		end);
	elseif u17 == false then
		u43._global_data_store = l__DataStoreService__42:GetDataStore(v222, v223, v226);
	end;
	return nil;
end;
function v10.IsLive()
	while u8 == true do
		task.wait();	
	end;
	return u17 == false;
end;
if l__RunService__11:IsStudio() == true then
	u8 = true;
	task.spawn(function()
		local v227, v228 = pcall(function()
			l__DataStoreService__42:GetDataStore("____PS"):SetAsync("____PS", os.time());
		end);
		local v229 = false;
		if v227 == false then
			v229 = string.find(v228, "ConnectFail", 1, true) ~= nil;
		end;
		if v229 == true then
			warn("[ProfileService]: No internet access - check your network connection");
		end;
		if v227 == false and (string.find(v228, "403", 1, true) ~= nil or string.find(v228, "must publish", 1, true) ~= nil or v229 == true) then
			u17 = true;
			v10._use_mock_data_store = true;
			print("[ProfileService]: Roblox API services unavailable - data will not be saved");
		else
			print("[ProfileService]: Roblox API services available - data will be saved");
		end;
		u8 = false;
	end);
end;
local u44 = 0;
l__RunService__11.Heartbeat:Connect(function()
	local v230 = #l___auto_save_list__21;
	if v230 > 0 then
		local v231 = u7.AutoSaveProfiles / v230;
		local v232 = os.clock();
		while v231 < v232 - u23 do
			u23 = u23 + v231;
			local v233 = l___auto_save_list__21[u22];
			if v232 - v233._load_timestamp < u7.AutoSaveProfiles then
				for v234 = 1, v230 - 1 do
					u22 = u22 + 1;
					if v230 < u22 then
						u22 = 1;
					end;
					v233 = l___auto_save_list__21[u22];
					if u7.AutoSaveProfiles <= v232 - v233._load_timestamp then
						break;
					end;
					v233 = nil;
				end;
			end;
			u22 = u22 + 1;
			if v230 < u22 then
				u22 = 1;
			end;
			if v233 ~= nil then
				task.spawn(u35, v233);
			end;		
		end;
	end;
	if v10.CriticalState == false then
		if u7.IssueCountForCriticalState <= #l___issue_queue__9 then
			v10.CriticalState = true;
			v10.CriticalStateSignal:Fire(true);
			u44 = os.clock();
			warn("[ProfileService]: Entered critical state");
		end;
	elseif u7.IssueCountForCriticalState <= #l___issue_queue__9 then
		u44 = os.clock();
	elseif u7.CriticalStateLast < os.clock() - u44 then
		v10.CriticalState = false;
		v10.CriticalStateSignal:Fire(false);
		warn("[ProfileService]: Critical state ended");
	end;
	while true do
		local v235 = l___issue_queue__9[1];
		if v235 == nil then
			return;
		end;
		if not (u7.IssueLast < os.clock() - v235) then
			break;
		end;
		table.remove(l___issue_queue__9, 1);	
	end;
end);
task.spawn(function()
	while u8 == true do
		task.wait();	
	end;
	v9.ConnectToOnClose(function()
		v10.ServiceLocked = true;
		local v236 = 0;
		local v237 = {};
		local v238, v239, v240 = ipairs(l___auto_save_list__21);
		while true do
			v238(v239, v240);
			if not v238 then
				break;
			end;
			v240 = v238;
			v237[v238] = v239;		
		end;
		local v241, v242, v243 = ipairs(v237);
		while true do
			v241(v242, v243);
			if not v241 then
				break;
			end;
			v243 = v241;
			if v242:IsActive() == true then
				v236 = v236 + 1;
				local u45 = v236;
				task.spawn(function()
					u35(v242, true);
					u45 = u45 - 1;
				end);
			end;		
		end;
		while v236 > 0 or u40 > 0 or u26 > 0 do
			task.wait();		
		end;
	end, u17 == false);
end);
return v10;
