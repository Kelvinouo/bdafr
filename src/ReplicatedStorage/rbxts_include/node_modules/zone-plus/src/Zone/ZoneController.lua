-- Decompiled with the Synapse X Luau decompiler.

local v1 = require(script.Parent.Maid);
local v2 = require(script.Parent.RotatedRegion3);
local l__enums__3 = require(script.Parent.Enum).enums;
local l__Players__4 = game:GetService("Players");
local l__RunService__5 = game:GetService("RunService");
local v6 = {};
local u1 = {};
local u2 = {};
local u3 = 0;
function v6.player(p1)
	return u1._getZonesAndPlayers(u2, u3, true, p1);
end;
local u4 = l__RunService__5:IsClient() and l__Players__4.LocalPlayer;
function v6.localPlayer(p2)
	local v7 = {};
	for v8, v9 in pairs((u1.getTouchingZones(u4, true, p2))) do
		if v9.activeTriggers.localPlayer then
			local v10 = v7[v9];
			if not v10 then
				v10 = {};
				v7[v9] = v10;
			end;
			v10[u4] = u4.Character and true;
		end;
	end;
	return v7;
end;
local l__Heartbeat__5 = l__RunService__5.Heartbeat;
local u6 = 0;
local u7 = {};
local u8 = nil;
local u9 = 0;
local u10 = false;
local u11 = function()
	u6 = 0;
	u7 = {};
	local v11 = {
		UpperTorso = true, 
		LowerTorso = true, 
		Torso = true, 
		LeftHand = true, 
		RightHand = true, 
		LeftFoot = true, 
		RightFoot = true
	};
	for v12, v13 in pairs(l__Players__4:GetPlayers()) do
		local v14 = u1.getCharacterRegion(v13);
		if v14 then
			local l__Size__15 = v14.Size;
			u6 = u6 + l__Size__15.X * l__Size__15.Y * l__Size__15.Z;
			for v16, v17 in pairs(v13.Character:GetChildren()) do
				if v17:IsA("BasePart") and not v11[v17.Name] then
					table.insert(u7, v17);
					local u12 = nil;
					u12 = v17:GetPropertyChangedSignal("Parent"):Connect(function()
						if v17.Parent == nil then
							u12:Disconnect();
							u8();
						end;
					end);
				end;
			end;
		end;
	end;
end;
u8 = function(...)
	u9 = u9 + 1;
	if u10 then
		return;
	end;
	local u13 = table.pack(...);
	coroutine.wrap(function()
		l__Heartbeat__5:Wait();
		u10 = false;
		if not (u9 > 1) then
			u9 = 0;
			return;
		end;
		u9 = 1;
		return u11(unpack(u13));
	end)();
	u10 = true;
	return u11(...);
end;
u11 = function(p3)
	p3.CharacterAdded:Connect(function(p4)
		local l__Humanoid__18 = p4:WaitForChild("Humanoid", 3);
		if l__Humanoid__18 then
			u8();
			for v19, v20 in pairs(l__Humanoid__18:GetChildren()) do
				if v20:IsA("NumberValue") then
					v20.Changed:Connect(function()
						u8();
					end);
				end;
			end;
		end;
	end);
end;
l__Players__4.PlayerAdded:Connect(u11);
for v21, v22 in pairs(l__Players__4:GetPlayers()) do
	v22.CharacterAdded:Connect(function(p5)
		local l__Humanoid__23 = p5:WaitForChild("Humanoid", 3);
		if l__Humanoid__23 then
			u8();
			for v24, v25 in pairs(l__Humanoid__23:GetChildren()) do
				if v25:IsA("NumberValue") then
					v25.Changed:Connect(function()
						u8();
					end);
				end;
			end;
		end;
	end);
end;
local u14 = {};
l__Players__4.PlayerRemoving:Connect(function(p6)
	u8();
	u14[p6] = nil;
end);
local u15 = {};
function u1._registerZone(p7)
	u15[p7] = true;
	local v26 = p7._maid:give(v1.new());
	p7._registeredMaid = v26;
	v26:give(p7.updated:Connect(function()
		u1._updateZoneDetails();
	end));
	u1._updateZoneDetails();
end;
function u1._deregisterZone(p8)
	u15[p8] = nil;
	p8._registeredMaid:clean();
	p8._registeredMaid = nil;
	u1._updateZoneDetails();
end;
local u16 = 0;
local u17 = {};
function u1._registerConnection(p9, p10)
	local v27 = 0;
	for v28, v29 in pairs(p9.activeTriggers) do
		v27 = v27 + 1;
	end;
	u16 = u16 + 1;
	if v27 == 0 then
		u2[p9] = true;
		u1._updateZoneDetails();
	end;
	local v30 = u17[p10];
	u17[p10] = v30 and v30 + 1 or 1;
	p9.activeTriggers[p10] = true;
	if p9.touchedConnectionActions[p10] then
		p9:_formTouchedConnection(p10);
	end;
	if v6[p10] then
		u1._formHeartbeat(p10);
	end;
end;
function u1.updateDetection(p11)
	for v31, v32 in pairs({
		enterDetection = "_currentEnterDetection", 
		exitDetection = "_currentExitDetection"
	}) do
		local v33 = p11[v31];
		if v33 == l__enums__3.Detection.Automatic then
			if u6 > 729000 then
				v33 = l__enums__3.Detection.Centre;
			else
				v33 = l__enums__3.Detection.WholeBody;
			end;
		end;
		p11[v32] = v33;
	end;
end;
local u18 = {};
function u1._formHeartbeat(p12)
	if u18[p12] then
		return;
	end;
	local u19 = 0;
	u18[p12] = l__Heartbeat__5:Connect(function()
		local v34 = os.clock();
		if u19 <= v34 then
			local v35 = nil;
			local v36 = nil;
			for v37, v38 in pairs(u2) do
				if v37.activeTriggers[p12] then
					local l__accuracy__39 = v37.accuracy;
					if v35 == nil or l__accuracy__39 < v35 then
						v35 = l__accuracy__39;
					end;
					u1.updateDetection(v37);
					local l___currentEnterDetection__40 = v37._currentEnterDetection;
					if v36 == nil or l___currentEnterDetection__40 < v36 then
						v36 = l___currentEnterDetection__40;
					end;
				end;
			end;
			local v41 = v35;
			local v42 = v6[p12](v36);
			for v43, v44 in pairs(u2) do
				if v43.activeTriggers[p12] then
					local l__accuracy__45 = v43.accuracy;
					local v46 = v42[v43] or {};
					local v47 = false;
					local v48, v49, v50 = pairs(v46);
					local v51, v52 = v48(v49, v50);
					if v51 then
						v47 = true;
					end;
					if v47 and v41 < l__accuracy__45 then
						v41 = l__accuracy__45;
					end;
					v43:_updateOccupants(p12, v46);
				end;
			end;
			u19 = v34 + l__enums__3.Accuracy.getProperty(v41);
		end;
	end);
end;
function u1._deregisterConnection(p13, p14)
	u16 = u16 - 1;
	if u17[p14] == 1 then
		u17[p14] = nil;
		local v53 = u18[p14];
		if v53 then
			u18[p14] = nil;
			v53:Disconnect();
		end;
	else
		u17[p14] = u17[p14] - 1;
	end;
	p13.activeTriggers[p14] = nil;
	local v54 = 0;
	for v55, v56 in pairs(p13.activeTriggers) do
		v54 = v54 + 1;
	end;
	if v54 == 0 then
		u2[p13] = nil;
		u1._updateZoneDetails();
	end;
	if p13.touchedConnectionActions[p14] then
		p13:_disconnectTouchedConnection(p14);
	end;
end;
local u20 = {};
local u21 = {};
local u22 = {};
local u23 = {};
function u1._updateZoneDetails()
	u20 = {};
	u21 = {};
	u22 = {};
	u23 = {};
	u3 = 0;
	local v57, v58, v59 = pairs(u15);
	while true do
		local v60, v61 = v57(v58, v59);
		if not v60 then
			break;
		end;
		local v62 = u2[v60];
		if v62 then
			u3 = u3 + v60.volume;
		end;
		for v63, v64 in pairs(v60.groupParts) do
			if v62 then
				table.insert(u20, v64);
				u21[v64] = v60;
			end;
			table.insert(u22, v64);
			u23[v64] = v60;
		end;	
	end;
end;
function u1._getZonesAndPlayers(p15, p16, p17, p18)
	local v65 = p16;
	if not v65 then
		for v66, v67 in pairs(p15) do
			v65 = v65 + v66.volume;
		end;
	end;
	local v68 = {};
	if u6 < v65 then
		for v69, v70 in pairs(l__Players__4:GetPlayers()) do
			for v71, v72 in pairs((u1.getTouchingZones(v70, p17, p18))) do
				if not p17 or v72.activeTriggers.player then
					local v73 = v68[v72];
					if not v73 then
						v73 = {};
						v68[v72] = v73;
					end;
					v73[v70] = v70.Character and true;
				end;
			end;
		end;
		return v68;
	end;
	for v74, v75 in pairs(p15) do
		if not p17 or v74.activeTriggers.player then
			local v76 = {};
			for v77, v78 in pairs((workspace:FindPartsInRegion3WithWhiteList(v74.region, u7, #u7))) do
				local l__Name__79 = v78.Parent.Name;
				if not v76[l__Name__79] then
					v76[l__Name__79] = l__Players__4:GetPlayerFromCharacter(v78.Parent);
				end;
			end;
			for v80, v81 in pairs(v76) do
				if v81 and v74:findPlayer(v81) then
					local v82 = v68[v74];
					if not v82 then
						v82 = {};
						v68[v74] = v82;
					end;
					v82[v81] = v81.Character and true;
				end;
			end;
		end;
	end;
	return v68;
end;
function u1.getZones()
	local v83 = {};
	for v84, v85 in pairs(u15) do
		table.insert(v83, v84);
	end;
	return v83;
end;
function u1.getCharacterRegion(p19)
	local l__Character__86 = p19.Character;
	local v87 = l__Character__86 and l__Character__86:FindFirstChild("Head");
	local v88 = l__Character__86 and l__Character__86:FindFirstChild("HumanoidRootPart");
	if not v88 or not v87 then
		return nil;
	end;
	local l__Y__89 = v87.Size.Y;
	local l__Size__90 = v88.Size;
	local v91 = l__Size__90 * Vector3.new(2, 2, 1) + Vector3.new(0, l__Y__89, 0);
	local v92 = v88.CFrame * CFrame.new(0, l__Y__89 / 2 - l__Size__90.Y / 2, 0);
	return v2.new(v92, v91), v92, v91;
end;
function u1.getTouchingZones(p20, p21, p22)
	u14[p20] = nil;
	local v93 = u14[p20] and p22;
	if v93 == l__enums__3.Detection.WholeBody then
		local v94 = u1.getCharacterRegion(p20);
	else
		local l__Character__95 = p20.Character;
		local v96 = l__Character__95 and l__Character__95:FindFirstChild("HumanoidRootPart");
		local v97 = v96 and v96.CFrame;
		v94 = v97 and v2.new(v97, Vector3.new(0.1, 0.1, 0.1));
	end;
	if not v94 then
		return {};
	end;
	local v98 = p21 and u20 or u22;
	local v99 = p21 and u21 or u23;
	local v100 = v94:FindPartsInRegion3WithWhiteList(v98, #v98);
	if #v100 > 0 then
		local l__HumanoidRootPart__101 = p20.Character.HumanoidRootPart;
		local l__CFrame__102 = l__HumanoidRootPart__101.CFrame;
		local l__X__103 = l__HumanoidRootPart__101.Size.X;
		if v93 == l__enums__3.Detection.WholeBody then
			local v104 = { (l__CFrame__102 * CFrame.new(-l__X__103, 0, 0)).Position, (l__CFrame__102 * CFrame.new(l__X__103, 0, 0)).Position };
		else
			v104 = { l__HumanoidRootPart__101.Position };
		end;
		if not u1.verifyTouchingParts(v104, v100) then
			return {};
		end;
	end;
	local v105 = {};
	local v106 = {};
	for v107, v108 in pairs(v100) do
		local v109 = v99[v108];
		if v109 then
			v105[v109] = true;
			v106[v108] = v109;
		end;
	end;
	local v110 = {};
	local v111 = nil;
	for v112, v113 in pairs(v105) do
		if v111 == nil or v112._currentExitDetection < v111 then
			v111 = v112._currentExitDetection;
		end;
		table.insert(v110, v112);
	end;
	if v111 then
		u14[p20] = v111;
	end;
	return v110, v106;
end;
function u1.getHeightOfParts(p23)
	local v114 = nil;
	local v115 = nil;
	local v116, v117, v118 = pairs(p23);
	while true do
		local v119, v120 = v116(v117, v118);
		if not v119 then
			break;
		end;
		local v121 = (v120.Size.Y + 10) / 2;
		local v122 = v120.Position.Y + v121;
		local v123 = v120.Position.Y - v121;
		if v114 == nil or v114 < v122 then
			v114 = v122;
		end;
		if v115 == nil or v123 < v115 then
			v115 = v123;
		end;	
	end;
	return v114 - v115, v115, v114;
end;
function u1.vectorIsBetweenYBounds(p24, p25)
	local v124, v125, v126 = u1.getHeightOfParts(p25);
	local v127 = RaycastParams.new();
	v127.FilterDescendantsInstances = p25;
	v127.FilterType = Enum.RaycastFilterType.Whitelist;
	local v128 = 1 - 1;
	while true do
		local v129 = workspace:Raycast(Vector3.new(p24.X, v128 == 1 and v126 or v125, p24.Z), Vector3.new(0, v128 == 1 and -v124 or v124, 0), v127);
		local l__Y__130 = p24.Y;
		local v131 = v129 and v129.Position.Y;
		if not v131 then
			break;
		end;
		if v128 == 1 and v131 < l__Y__130 then
			break;
		end;
		if v128 == 2 and l__Y__130 < v131 then
			break;
		end;
		if 0 <= 1 then
			if not (v128 < 2) then
				return true;
			end;
		elseif not (v128 > 2) then
			return true;
		end;
		v128 = v128 + 1;	
	end;
	return false;
end;
function u1.verifyTouchingParts(p26, p27)
	local v132 = {
		MeshPart = true, 
		UnionOperation = true
	};
	local v133 = true;
	for v134, v135 in pairs(p27) do
		if not v132[v135.ClassName] then
			v133 = false;
		end;
	end;
	if not v133 then
		return true;
	end;
	for v136, v137 in pairs(p26) do
		if u1.vectorIsBetweenYBounds(v137, p27) then
			return true;
		end;
	end;
	return false;
end;
return u1;
