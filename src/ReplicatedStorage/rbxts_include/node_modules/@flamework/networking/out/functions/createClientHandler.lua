-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, script.Parent, "errors");
local u1 = nil;
local l__getFunctionError__2 = v2.getFunctionError;
local l__fireNetworkHandler__3 = v1.import(script, script.Parent.Parent, "handlers").fireNetworkHandler;
local l__Players__4 = v1.import(script, v1.getModule(script, "@rbxts", "services")).Players;
local l__NetworkingFunctionError__5 = v2.NetworkingFunctionError;
local u6 = nil;
local u7 = nil;
local u8 = v1.import(script, script.Parent.Parent, "middleware", "createMiddlewareProcessor").createMiddlewareProcessor;
u1 = function(p1, p2, p3, p4, p5, p6, p7)
	local v3 = {};
	function v3.invoke(p8, ...)
		local v4 = {};
		local u9 = { ... };
		v4[1] = u7(10, l__NetworkingFunctionError__5.Timeout);
		v4[2] = v1.Promise.new(function(p9, p10, p11)
			p5.nextId = p5.nextId + 1;
			local l__nextId__5 = p5.nextId;
			p5.requests[l__nextId__5] = function(p12, p13)
				if p13 then
					return p10(p13);
				end;
				if p1(p12) then
					p9(p12);
					return;
				end;
				l__fireNetworkHandler__3("onBadResponse", l__Players__4.LocalPlayer, p4);
				return p10(l__NetworkingFunctionError__5.InvalidResult);
			end;
			p11(function()
				p5.requests[l__nextId__5] = nil;
			end);
			p7:FireServer(l__nextId__5, unpack(u9));
		end);
		return v1.Promise.race(v4);
	end;
	function v3.setCallback(p14, p15)
		if p3[p6] ~= nil then
			warn("Function.setCallback was called multiple times for " .. p6);
		end;
		p3[p6] = u8(p2, p4, function(p16, ...)
			return p15(unpack({ ... }));
		end);
	end;
	function v3.predict(p17, ...)
		local u10 = { ... };
		return v1.Promise.new(function(p18, p19)
			local v6 = p3[p6];
			if not v6 then
				return p19(l__NetworkingFunctionError__5.Unprocessed);
			end;
			p18(v6(nil, unpack(u10)));
		end);
	end;
	setmetatable(v3, {
		__call = function(p20, ...)
			return p20:invoke(unpack({ ... }));
		end
	});
	return v3;
end;
u7 = function(p21, p22)
	return v1.Promise.delay(p21):andThen(function()
		return v1.Promise.reject(p22);
	end);
end;
local l__Skip__11 = v1.import(script, script.Parent.Parent, "middleware", "skip").Skip;
u6 = function(p23)
	return p23 == l__Skip__11 and l__NetworkingFunctionError__5.Cancelled or true;
end;
return {
	createClientHandler = function(p24, p25, p26, p27, p28, p29)
		local u12 = {};
		local u13 = {};
		local u14 = {
			nextId = 0, 
			requests = {}
		};
		local function v7(p30, p31, p32)
			if u12[p30] ~= nil then
				return nil;
			end;
			local v8 = p27[p30];
			if v8 == nil then
				v8 = p28[p30];
			end;
			local v9 = p29;
			if v9 ~= nil then
				v9 = v9[p30];
			end;
			local v10 = v9;
			if v10 == nil then
				v10 = {};
			end;
			u12[p30] = u1(v8[2], v10, u13, p31, u14, p30, p32);
		end;
		for v11, v12 in pairs(p24) do
			local v13 = string.sub(v11, 3);
			v7(v13, p26[v13], v12);
			v12.OnClientEvent:Connect(function(p33, p34, p35)
				if type(p33) ~= "number" then
					return nil;
				end;
				local v14 = u14.requests[p33];
				u14.requests[p33] = nil;
				if v14 then
					v14(p35, l__getFunctionError__2(p34));
				end;
			end);
		end;
		for v15, v16 in pairs(p25) do
			local v17 = string.sub(v15, 3);
			local v18 = p26[v17];
			v7(v17, v18, v16);
			v16.OnClientEvent:Connect(function(p36, ...)
				local v19 = { ... };
				local v20 = p28[v17];
				if not v20 then
					return nil;
				end;
				local v21 = 0;
				local v22 = false;
				while true do
					if v22 then
						v21 = v21 + 1;
					else
						v22 = true;
					end;
					if not (v21 < #v20[1]) then
						break;
					end;
					if not v20[1][v21 + 1](v19[v21 + 1]) then
						l__fireNetworkHandler__3("onBadRequest", l__Players__4.LocalPlayer, v18, v21);
						return v16:FireServer(p36, l__NetworkingFunctionError__5.BadRequest);
					end;				
				end;
				local v23 = u13[v17];
				if not v23 then
					v16:FireServer(p36, false);
					return;
				end;
				v23(nil, unpack(v19)):andThen(function(p37)
					return v16:FireServer(p36, u6(p37), p37);
				end):catch(function(p38)
					warn("Failed to process request to " .. v17);
					warn(p38);
					v16:FireServer(p36, false);
				end);
			end);
		end;
		return u12;
	end
};
