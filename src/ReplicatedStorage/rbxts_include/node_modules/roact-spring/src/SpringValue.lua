-- Decompiled with the Synapse X Luau decompiler.

local l__rbxts_include__1 = game:GetService("ReplicatedStorage"):FindFirstChild("rbxts_include");
local v2 = l__rbxts_include__1 and require(l__rbxts_include__1.RuntimeLib);
if v2 then
	local v3 = v2.Promise;
else
	v3 = require(script.Parent.Parent.Promise);
end;
local v4 = require(script.Parent.AnimationConfig);
local v5 = {};
v5.__index = v5;
local u1 = require(script.Parent.Animation);
local u2 = require(script.Parent.Signal);
function v5.new(p1, p2)
	assert(p1.from or p1.to, "`to` or `from` expected, none passed.");
	local v6 = {
		animation = u1.new(p1, p2)
	};
	local v7 = {};
	if p1.immediate ~= nil then
		local v8 = p1.immediate;
	else
		v8 = false;
	end;
	v7.immediate = v8;
	v7.config = p1.config;
	v6.defaultProps = v7;
	v6.onChange = p1.onChange or function()

	end;
	v6.onComplete = u2.new();
	v6._memoizedDuration = 0;
	v6.hasAnimated = false;
	return setmetatable(v6, v5);
end;
function v5.start(p3, p4)
	p3.hasAnimated = true;
	return p3:_update(p4);
end;
local u3 = require(script.Parent.util);
local u4 = require(script.Parent.helpers);
local l__RunService__5 = game:GetService("RunService");
function v5._update(p5, p6)
	if p6.default then
		p5.defaultProps = u3.merge(p5.defaultProps, u4.getDefaultProps(p6));
	end;
	return v3.new(function(p7, p8, p9)
		if p6.delay then
			task.wait(p6.delay);
		end;
		if p9() then
			return;
		end;
		local v9 = p5:_prepareNode(p6);
		local l__from__10 = v9.from;
		local v11 = v9.to;
		if l__from__10 and not v11 then
			v11 = l__from__10;
		end;
		local l__animation__12 = p5.animation;
		l__animation__12:mergeProps(u3.merge(p5.defaultProps, p6));
		if p6.reverse then
			l__animation__12.toValues = l__animation__12.fromValues;
			l__animation__12.fromValues = l__animation__12.toValues;
		end;
		p5.onChange = p6.onChange or p5.onChange;
		if p6.reset == nil then
			local v13 = l__from__10 ~= nil;
		else
			v13 = false;
			if l__animation__12.fromValues ~= nil then
				v13 = p6.reset;
			end;
		end;
		if v13 then
			l__animation__12.values = table.clone(l__animation__12.fromValues);
			if l__from__10 then
				local v14 = u4.getValuesFromType(l__from__10);
			else
				v14 = l__animation__12.lastPosition;
			end;
			l__animation__12.lastPosition = v14;
		end;
		l__animation__12.toValues = u4.getValuesFromType(v11);
		l__animation__12.fromValues = table.clone(l__animation__12.lastPosition);
		if not p5._connection then
			p5._connection = l__RunService__5.RenderStepped:Connect(function(p10)
				p5:advance(p10);
			end);
		end;
		p5.onComplete:Wait();
		p7();
	end);
end;
function v5.stop(p11)
	p11:_disconnect();
	p11.animation:stop();
end;
function v5.pause(p12)
	p12:_disconnect();
end;
function v5.advance(p13, p14)
	local v15 = true;
	local v16 = false;
	local l__animation__17 = p13.animation;
	local l__config__18 = l__animation__17.config;
	local l__toValues__19 = l__animation__17.toValues;
	for v20, v21 in ipairs(l__animation__17.values) do
		if not l__animation__17.done[v20] then
			local v22 = nil;
			local v23 = nil;
			local v24 = nil;
			local v25 = nil;
			local v26 = nil;
			local v27 = nil;
			local v28 = nil;
			local v29 = nil;
			local v30 = nil;
			local v31 = nil;
			local v32 = nil;
			local v33 = nil;
			local v34 = nil;
			local v35 = nil;
			local v36 = nil;
			local v37 = nil;
			local v38 = l__animation__17.immediate;
			local v39 = l__toValues__19[v20];
			local v40 = l__animation__17.fromValues[v20];
			local v41 = l__animation__17.toValues[v20];
			if not v38 then
				local v42 = l__animation__17.lastPosition[v20];
				if l__config__18.tension <= 0 then
					l__animation__17.done[v20] = true;
				else
					local l__elapsedTime__43 = l__animation__17.elapsedTime;
					l__elapsedTime__43[v20] = l__elapsedTime__43[v20] + p14;
					local v44 = l__animation__17.elapsedTime[v20];
					if l__animation__17.v0[v20] == nil then
						if typeof(l__config__18.velocity) == "table" then
							l__animation__17.v0[v20] = l__config__18.velocity[v20];
						else
							if v41 - v40 > 0 then
								local v45 = l__config__18.velocity;
							elseif v41 - v40 < 0 then
								v45 = -l__config__18.velocity;
							else
								v45 = 0;
							end;
							l__animation__17.v0[v20] = v45;
						end;
					end;
					local v46 = l__animation__17.v0[v20];
					if l__config__18.duration then
						local v47 = 1;
						if l__config__18.duration > 0 then
							if p13._memoizedDuration ~= l__config__18.duration then
								p13._memoizedDuration = l__config__18.duration;
								if l__animation__17.durationProgress[v20] > 0 then
									l__animation__17.elapsedTime[v20] = l__config__18.duration * l__animation__17.durationProgress[v20];
									local l__elapsedTime__48 = l__animation__17.elapsedTime;
									l__elapsedTime__48[v20] = l__elapsedTime__48[v20] + p14;
									v44 = l__animation__17.elapsedTime[v20];
								end;
							end;
							local v49 = (l__config__18.progress and 0) + v44 / p13._memoizedDuration;
							if v49 > 1 then
								v47 = 1;
							elseif v49 < 0 then
								v47 = 0;
							else
								v47 = v49;
							end;
							l__animation__17.durationProgress[v20] = v47;
						end;
						v39 = v40 + l__config__18.easing(v47) * (v41 - v40);
						local v50 = (v39 - l__animation__17.lastPosition[v20]) / p14;
						v38 = v47 == 1;
					else
						v50 = l__animation__17.lastVelocity[v20] and v46;
						local v51 = l__config__18.precision;
						if not v51 then
							if v40 == v41 then
								v51 = 0.005;
							else
								v51 = math.min(1, math.abs(v41 - v40) * 0.001);
							end;
						end;
						local v52 = l__config__18.restVelocity or v51 / 10;
						if l__config__18.clamp then
							local v53 = 0;
						else
							v53 = l__config__18.bounce;
						end;
						local v54 = v53 ~= nil;
						if v40 == v41 then
							local v55 = v46 > 0;
						elseif not (v40 < v41) then
							v55 = false;
						else
							v55 = true;
						end;
						for v56 = 0, math.ceil(p14 * 1000 / 2) do
							local v57 = v52 < math.abs(v50);
							if not v57 then
								v38 = math.abs(v41 - v39) <= v51;
								if v38 then
									break;
								end;
							end;
							if v54 then
								local v58 = true;
								if v42 ~= v41 then
									local v59 = v41 < v42;
									v58 = v59 == v55;
								end;
								if v58 then
									v50 = -v50 * v53;
									v42 = v41;
								end;
							end;
							v50 = v50 + (-l__config__18.tension * 1E-06 * (v42 - v41) + -l__config__18.friction * 0.001 * v50) / l__config__18.mass;
							v42 = v42 + v50;
						end;
					end;
					l__animation__17.lastVelocity[v20] = v50;
					v22 = v38;
					if v22 then
						v39 = v41;
						l__animation__17.done[v20] = true;
					else
						v15 = false;
					end;
					v23 = v20;
					v31 = v23;
					v24 = v39;
					v32 = v24;
					v26 = "setValue";
					v25 = l__animation__17;
					v30 = v25;
					v27 = l__animation__17;
					v28 = v26;
					v29 = v27[v28];
					v33 = v29;
					v34 = v30;
					v35 = v31;
					v36 = v32;
					local v60 = v33(v34, v35, v36);
					v37 = v60;
					if v37 then
						v16 = true;
					end;
				end;
			else
				v22 = v38;
				if v22 then
					v39 = v41;
					l__animation__17.done[v20] = true;
				else
					v15 = false;
				end;
				v23 = v20;
				v31 = v23;
				v24 = v39;
				v32 = v24;
				v26 = "setValue";
				v25 = l__animation__17;
				v30 = v25;
				v27 = l__animation__17;
				v28 = v26;
				v29 = v27[v28];
				v33 = v29;
				v34 = v30;
				v35 = v31;
				v36 = v32;
				v60 = v33(v34, v35, v36);
				v37 = v60;
				if v37 then
					v16 = true;
				end;
			end;
		end;
	end;
	if not v15 then
		if v16 then
			p13.onChange(l__animation__17:getValue());
		end;
		return;
	end;
	p13.onChange(l__animation__17:getValue());
	p13:_disconnect();
	p13.animation:stop();
	p13.onComplete:Fire();
end;
function v5._prepareNode(p15, p16)
	local v61 = p15.key and "";
	local v62 = p16.to;
	local v63 = p16.from;
	if typeof(v62) == "table" then
		v62 = v62[v61];
	end;
	if typeof(v63) == "table" then
		v63 = v63[v61];
	end;
	if not p15.hasAnimated then
		if p16.reverse then
			v62 = v63;
			v63 = v62;
		end;
		local v64 = u4.getValuesFromType(v63 and v62);
		p15.animation = p15.animation or u1.new(#v64);
		p15.animation.values = table.clone(v64);
		p15.animation.lastPosition = table.clone(v64);
		p15.onChange(v63 and v62);
	end;
	return {
		to = v62, 
		from = v63
	};
end;
function v5._disconnect(p17)
	if p17._connection then
		p17._connection:Disconnect();
		p17._connection = nil;
	end;
end;
return v5;
