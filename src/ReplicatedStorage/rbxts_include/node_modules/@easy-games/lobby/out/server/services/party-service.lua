
-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local l__Reflect__2 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Reflect;
local v3 = setmetatable({}, {
	__tostring = function()
		return "PartyService";
	end
});
v3.__index = v3;
function v3.new(...)
	local v4 = setmetatable({}, v3);
	return v4:constructor(...) and v4;
end;
function v3.constructor(p1, p2, p3)
	p1.queueService = p2;
	p1.matchmakingService = p3;
	p1.parties = {};
	p1.waitingPlayers = {};
end;
local l__PlayerAdded__1 = v1.import(script, v1.getModule(script, "@easy-games", "game-core").out).PlayerAdded;
local l__Players__2 = v1.import(script, v1.getModule(script, "@rbxts", "services")).Players;
function v3.onStart(p4)
	l__PlayerAdded__1(function(p5)
		local l__waitingPlayers__5 = p4.waitingPlayers;
		local u3 = p4:createParty(p5);
		local function v6(p6, p7)
			if p6.leaderUserId == p5.UserId then
				local v7 = l__Players__2:GetPlayerByUserId(p7);
				if v7 and os.time() - p6.time <= 30 then
					p4:joinParty(v7, u3);
					p4.waitingPlayers[p7] = nil;
				end;
			end;
		end;
		for v8, v9 in pairs(l__waitingPlayers__5) do
			v6(v9, v8, l__waitingPlayers__5);
		end;
	end);
	l__Players__2.PlayerRemoving:Connect(function(p8)
		return p4:onPlayerDisconnect(p8);
	end);
	p4.matchmakingService:registerPartyProducer(function()
		return p4:getParties();
	end);
end;
function v3.onPlayerDisconnect(p9, p10)
	local v10 = p9:getPartyForPlayer(p10);
	if v10 then
		p9:removePlayerFromParty(p10, v10, false);
	end;
end;
local l__Party__4 = v1.import(script, script.Parent.Parent, "lib", "party").Party;
function v3.joinParty(p11, p12, p13)
	if not (#p13:getPlayers() < l__Party__4.MAX_SIZE) then
		return false;
	end;
	local v11 = p11:getPartyForPlayer(p12);
	if v11 then
		p11:removePlayerFromParty(p12, v11, false);
		v11:sendPartyInfoEvent();
	end;
	p13:addPlayer(p12);
	if p13:getQueueData() then
		p11.queueService:leaveQueue(p13);
	end;
	p13:sendPartyInfoEvent();
	return true;
end;
function v3.removePlayerFromParty(p14, p15, p16, p17)
	if p16:getQueueData() then
		p14.queueService:leaveQueue(p16, not p17);
	end;
	p16:removePlayer(p15);
	p16:cancelInvite(p15.UserId);
	p16:sendPartyInfoEvent();
	if #p16:getPlayers() == 0 or p16:getLeader() == p15 then
		p14:disbandParty(p16);
	end;
	if p17 then
		p14:createParty(p15):sendPartyInfoEvent();
	end;
end;
function v3.createParty(p18, p19)
	local v12 = l__Party__4.new(p19);
	local l__parties__13 = p18.parties;
	l__parties__13[#l__parties__13 + 1] = v12;
	return v12;
end;
function v3.disbandParty(p20, p21)
	print("disbanding party!");
	for v14, v15 in ipairs(p21:getMembers()) do
		p20:removePlayerFromParty(v15, p21, true);
	end;
	table.remove(p20.parties, (table.find(p20.parties, p21) and 0) - 1 + 1);
end;
function v3.getPartyForPlayer(p22, p23)
	local l__parties__16 = p22.parties;
	local function v17(p24)
		return table.find(p24:getPlayers(), p23) ~= nil;
	end;
	for v18, v19 in ipairs(l__parties__16) do
		if v17(v19, v18 - 1, l__parties__16) == true then
			return v19;
		end;
	end;
	return nil;
end;
function v3.getPartyByLeader(p25, p26)
	local l__parties__20 = p25.parties;
	local function v21(p27)
		return p27:getLeader().UserId == p26;
	end;
	for v22, v23 in ipairs(l__parties__20) do
		if v21(v23, v22 - 1, l__parties__20) == true then
			return v23;
		end;
	end;
	return nil;
end;
function v3.getParties(p28)
	return p28.parties;
end;
function v3.getWaitingPlayers(p29)
	return p29.waitingPlayers;
end;
function v3.setWaitingPlayer(p30, p31, p32)
	p30.waitingPlayers[p31] = {
		leaderUserId = p32, 
		time = os.time()
	};
end;
l__Reflect__2.defineMetadata(v3, "identifier", "@easy-games/lobby:server/services/party-service@PartyService");
l__Reflect__2.defineMetadata(v3, "flamework:isExternal", true);
l__Reflect__2.defineMetadata(v3, "flamework:dependencies", { "@easy-games/lobby:server/services/queue-service@QueueService", "@easy-games/lobby:server/services/matchmaking-service@MatchmakingService" });
l__Reflect__2.defineMetadata(v3, "flamework:implements", { "$:flamework@OnStart" });
l__Reflect__2.defineMetadata(v3, "flamework:decorators", { "$:flamework@Service" });
l__Reflect__2.defineMetadata(v3, "flamework:decorators.$:flamework@Service", {
	type = "Service"
});
return {
	PartyService = v3
};

