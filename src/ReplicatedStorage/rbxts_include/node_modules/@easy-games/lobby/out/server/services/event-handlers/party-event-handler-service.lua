-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local l__Reflect__2 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Reflect;
local v3 = v1.import(script, v1.getModule(script, "@easy-games", "game-core").out);
local v4 = v1.import(script, v1.getModule(script, "@flamework", "core").out);
local v5 = setmetatable({}, {
	__tostring = function()
		return "PartyServerEventHandlerService";
	end
});
v5.__index = v5;
function v5.new(...)
	local v6 = setmetatable({}, v5);
	return v6:constructor(...) and v6;
end;
function v5.constructor(p1, p2, p3)
	p1.partyService = p2;
	p1.notificationService = p3;
end;
function v5.onInit(p4)
	p4:connectEvents();
end;
local l__LobbyServerEvents__1 = v1.import(script, script.Parent.Parent.Parent, "events", "events").LobbyServerEvents;
local l__PartyRole__2 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "party", "party-role").PartyRole;
local l__OfflinePlayerUtil__3 = v3.OfflinePlayerUtil;
local l__ColorUtil__4 = v3.ColorUtil;
local l__GameTheme__5 = v3.GameTheme;
function v5.connectEvents(p5)
	l__LobbyServerEvents__1.lobbyPlayerConnect:connect(function(p6, p7)
		if p6:GetAttribute("LobbyConnected") == true then
			return nil;
		end;
		p6:SetAttribute("LobbyConnected", true);
		print(p6.Name .. " connect:", p7);
		if p7.party then
			local v7 = p7.party.leaderUserId;
			if v7 ~= 0 and v7 == v7 and v7 then
				v7 = p7.party.leaderUserId ~= p6.UserId;
			end;
			if v7 ~= 0 and v7 == v7 and v7 then
				local v8 = p5.partyService:getPartyByLeader(p7.party.leaderUserId);
				if v8 then
					p5.partyService:joinParty(p6, v8);
					return;
				end;
				p5.partyService:setWaitingPlayer(p6.UserId, p7.party.leaderUserId);
			end;
		end;
	end);
	l__LobbyServerEvents__1.inviteToParty:connect(function(p8, p9)
		local v9 = p5.partyService:getPartyForPlayer(p8);
		if not v9 or v9:getPlayerRole(p8) ~= l__PartyRole__2.LEADER or table.find(v9:getPlayers(), p9.player) ~= nil then
			return false;
		end;
		v9:invitePlayer(p9.player, l__OfflinePlayerUtil__3.getOfflinePlayer(p8));
		v9:sendPartyInfoEvent();
		return true;
	end);
	l__LobbyServerEvents__1.removeFromParty:connect(function(p10, p11)
		local v10 = p5.partyService:getPartyForPlayer(p10);
		if not v10 or v10:getPlayerRole(p10) ~= l__PartyRole__2.LEADER or table.find(v10:getMembers(), p11.player) == nil then
			return false;
		end;
		p5.partyService:removePlayerFromParty(p11.player, v10, true);
		p5.notificationService:sendErrorNotification({ p11.player }, {
			message = "You have been removed from the party."
		});
		v10:sendPartyInfoEvent();
		return true;
	end);
	l__LobbyServerEvents__1.joinParty:connect(function(p12, p13)
		local v11 = p5.partyService:getPartyForPlayer(p13.leader);
		if not v11 or not v11:isInvited(p12) then
			return false;
		end;
		return p5.partyService:joinParty(p12, v11);
	end);
	l__LobbyServerEvents__1.leaveParty:connect(function(p14)
		local v12 = p5.partyService:getPartyForPlayer(p14);
		if not v12 then
			return false;
		end;
		p5.partyService:removePlayerFromParty(p14, v12, true);
		v12:sendPartyInfoEvent();
		p5.notificationService:sendErrorNotification(v12:getPlayers(), {
			message = "<font color=\"" .. l__ColorUtil__4.richTextColor(l__GameTheme__5.mcAqua) .. "\">" .. p14.DisplayName .. "</font> left the party.<br/>"
		});
		return true;
	end);
	l__LobbyServerEvents__1.requestPartyInfo:connect(function(p15)
		local v13 = p5.partyService:getPartyForPlayer(p15);
		if v13 then
			l__LobbyServerEvents__1.partyInfoEvent:fire(p15, {
				party = v13:getDto()
			});
		end;
	end);
end;
l__Reflect__2.defineMetadata(v5, "identifier", "@easy-games/lobby:server/services/event-handlers/party-event-handler-service@PartyServerEventHandlerService");
l__Reflect__2.defineMetadata(v5, "flamework:parameters", { "@easy-games/lobby:server/services/party-service@PartyService", "@easy-games/game-core:server/services/notification-service@NotificationService" });
l__Reflect__2.defineMetadata(v5, "flamework:implements", { "$:flamework@OnInit" });
l__Reflect__2.decorate(v5, "$:flamework@Service", v4.Service, { {} });
l__Reflect__2.decorate(v5, "$:flamework@External", v4.External, {});
return {
	PartyServerEventHandlerService = v5
};
