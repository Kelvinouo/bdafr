
-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = {};
local v3 = setmetatable({}, {
	__index = v2
});
v3.Merge = 0;
v2[0] = "Merge";
v3.HighestOnly = 1;
v2[1] = "HighestOnly";
local v4 = setmetatable({}, {
	__tostring = function()
		return "ModifierGroup";
	end
});
v4.__index = v4;
function v4.new(...)
	local v5 = setmetatable({}, v4);
	return v5:constructor(...) and v5;
end;
function v4.constructor(p1, p2, p3)
	p1.instance = p2;
	p1.config = p3;
	p1.modifiers = {};
	p1.baseProperties = p3.baseProperties;
	p1:addModifier(0, p3.baseProperties);
end;
local l__HttpService__1 = v1.import(script, v1.getModule(script, "@rbxts", "services")).HttpService;
local l__ActiveModifier__2 = v1.import(script, script.Parent, "active-modifier").ActiveModifier;
local l__default__3 = v1.import(script, v1.getModule(script, "@rbxts", "log").out).default;
function v4.addModifier(p4, p5, p6)
	local v6 = l__HttpService__1:GenerateGUID(false);
	local v7 = l__ActiveModifier__2.new(p5, p6, v6, function()
		return p4:reconcileModifiers();
	end, function()
		return p4:removeModifier(v6);
	end);
	p4.modifiers[v6] = v7;
	l__default__3.Verbose("Added modifier ({ID}) to instance {@Instance} at priority {Priority}", v6, p4.instance, p5);
	p4:reconcileModifiers();
	return v7;
end;
function v4.removeModifier(p7, p8)
	p7.modifiers[p8] = nil;
	p7:reconcileModifiers();
end;
function v4.getModifiers(p9)
	return p9.modifiers;
end;
local u4 = v1.import(script, v1.getModule(script, "@rbxts", "object-utils"));
function v4.reconcileModifiers(p10)
	local v8 = nil;
	l__default__3.Verbose("Starting reconcile for instance {@Instance}", p10.instance);
	local v9 = u4.values(p10.modifiers);
	table.sort(v9, function(p11, p12)
		return p12:getPriority() < p11:getPriority();
	end);
	v8 = v9;
	local v10 = {};
	if p10.config.behavior == v3.Merge then
		for v11, v12 in ipairs(v8) do
			for v13, v14 in pairs(v12:getProperties()) do
				if v10[v13] == nil then
					v10[v13] = v14;
				end;
			end;
		end;
	else
		local v15 = v8[1];
		if not v15 then
			error(l__default__3.Error("Somehow, there was no highest priority modifier"));
		end;
		local v16 = {};
		for v17, v18 in pairs(p10.baseProperties) do
			v16[v17] = v18;
		end;
		for v19, v20 in pairs(v15:getProperties()) do
			v16[v19] = v20;
		end;
		v10 = v16;
	end;
	l__default__3.Info("Applying new properties to instance {@Instance}: {@Properties}", p10.instance, v10);
	for v21, v22 in pairs(v10) do
		p10.instance[v21] = v22;
	end;
end;
return {
	GroupModifierBehavior = v3, 
	ModifierGroup = v4
};

