-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = setmetatable({}, {
	__tostring = function()
		return "Session";
	end
});
v2.__index = v2;
function v2.new(...)
	local v3 = setmetatable({}, v2);
	return v3:constructor(...) and v3;
end;
function v2.constructor(p1, p2)
	p1.destroyFunction = p2;
end;
function v2.Destroy(p3)
	p3.destroyFunction();
end;
local v4 = setmetatable({}, {
	__tostring = function()
		return "ISessionManager";
	end
});
v4.__index = v4;
function v4.new(...)
	local v5 = setmetatable({}, v4);
	return v5:constructor(...) and v5;
end;
local l__Players__1 = v1.import(script, v1.getModule(script, "@rbxts", "services")).Players;
function v4.constructor(p4)
	p4.sessionCompleteCallbacks = {};
	p4.playerRemovingCallbacks = {};
	l__Players__1.PlayerAdded:Connect(function(p5)
		p4:handlePlayer(p5);
	end);
	for v6, v7 in ipairs(l__Players__1:GetPlayers()) do
		p4:handlePlayer(v7);
	end;
end;
function v4.onSessionComplete(p6, p7)
	p6.sessionCompleteCallbacks[p7] = true;
	return v2.new(function()
		p6.sessionCompleteCallbacks[p7] = nil;
	end);
end;
function v4.onPlayerRemoving(p8, p9)
	p8.playerRemovingCallbacks[p9] = true;
	return v2.new(function()
		p8.playerRemovingCallbacks[p9] = nil;
	end);
end;
local u2 = v1.import(script, v1.getModule(script, "@rbxts", "maid").Maid);
local l__SetUtil__3 = v1.import(script, v1.getModule(script, "@easy-games", "data-structure").out).SetUtil;
function v4.handlePlayer(p10, p11)
	local v8 = u2.new();
	local u4 = false;
	v8:GiveTask(l__Players__1.PlayerRemoving:Connect(function(p12)
		if p12 ~= p11 then
			return nil;
		end;
		if not u4 then
			local v9, v10, v11 = ipairs(l__SetUtil__3.values(p10.sessionCompleteCallbacks));
			while true do
				local v12, v13 = v9(v10, v11);
				if not v12 then
					break;
				end;
				local v14, v15 = pcall(function()
					v13(p11);
				end);
				local v16 = v14 and {
					success = true, 
					value = v15
				} or {
					success = false, 
					error = v15
				};
				if not v16.success then
					v1.Promise.defer(function()
						error(v16.error);
					end);
				end;			
			end;
		end;
		local v17, v18, v19 = ipairs(l__SetUtil__3.values(p10.playerRemovingCallbacks));
		while true do
			local v20, v21 = v17(v18, v19);
			if not v20 then
				break;
			end;
			local v22, v23 = pcall(function()
				v21(p11, not u4);
			end);
			local v24 = v22 and {
				success = true, 
				value = v23
			} or {
				success = false, 
				error = v23
			};
			if not v24.success then
				v1.Promise.defer(function()
					error(v24.error);
				end);
			end;		
		end;
	end));
	v8:GiveTask(p11.OnTeleport:Connect(function(p13)
		if p13 ~= Enum.TeleportState.Failed then
			u4 = true;
			return;
		end;
		u4 = false;
	end));
	v8:GiveTask(p11.AncestryChanged:Connect(function()
		if not p11.Parent then
			v8:DoCleaning();
		end;
	end));
end;
return {
	SessionManager = v4.new()
};
