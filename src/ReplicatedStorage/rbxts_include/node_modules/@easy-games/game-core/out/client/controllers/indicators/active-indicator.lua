-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, v1.getModule(script, "@rbxts", "services"));
local v3 = {};
local u1 = v1.import(script, v1.getModule(script, "@rbxts", "maid").Maid);
local l__Flamework__2 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Flamework;
function v3.constructor(p1, p2, p3, p4)
	p1.indicatorId = p2;
	p1.boundaryUi = p3;
	p1.config = p4;
	p1.maid = u1.new();
	p1.ui = p1:createUi();
	p1.maid:GiveTask(p1.ui);
	p1.maid:GiveTask(function()
		return l__Flamework__2.resolveDependency("@easy-games/game-core:client/controllers/indicators/world-indicator-controller@WorldIndicatorController"):removeIndicator(p2);
	end);
	if typeof(p4.attachTo) == "Instance" then
		p4.attachTo.Destroying:Connect(function()
			return p1.maid:DoCleaning();
		end);
	end;
end;
function v3.slidePoints(p5, p6, p7)
	local v4 = math.atan2(p7.Y, p7.X);
	local l__Magnitude__5 = (p6 / 2).Magnitude;
	local l__Magnitude__6 = p7.Magnitude;
	return Vector2.new(math.cos(v4) * l__Magnitude__5, math.sin(v4) * l__Magnitude__5), Vector2.new(math.cos(v4) * l__Magnitude__6, math.sin(v4) * l__Magnitude__6);
end;
function v3.snapMethod(p8, p9, p10, p11, p12, p13, p14)
	local v7 = nil;
	v7 = math.clamp(math.abs(p9[p14] - p12) / math.abs(p10[p14] - p12), 0, 1);
	if p11[p13] < p10[p13] then
		local v8 = p11[p13];
		local v9 = p10[p13];
		local v10 = math.clamp((1 - v7) * v8 + v7 * v9, v8, v9);
	else
		local v11 = p10[p13];
		local v12 = p11[p13];
		v10 = math.clamp((1 - v7) * v12 + v7 * v11, v11, v12);
	end;
	if p13 == "X" then
		return Vector2.new(v10, p12);
	end;
	return Vector2.new(p12, v10);
end;
function v3.screenBoundaryMethod(p15, p16, p17)
	local v13 = Vector2.new(p16.Width, p16.Height);
	local v14 = v13.Y / v13.X;
	local v15 = (p16.Min + p16.Max) / 2;
	local v16 = p17 - v15;
	local v17, v18 = v3:slidePoints(v13, v16);
	local v19 = v17 + v15;
	local v20 = v18 + v15;
	if v16.X * v14 <= v16.Y then
		if -v16.X * v14 <= v16.Y then
			local v21 = p17.Y <= p16.Max.Y;
			if v19.X < p16.Min.X then
				return v21, Vector2.new(p16.Min.X, p16.Max.Y);
			elseif p16.Max.X < v19.X then
				return v21, Vector2.new(p16.Max.X, p16.Max.Y);
			else
				return v21, v3:snapMethod(p17, v19, v20, p16.Max.Y, "X", "Y");
			end;
		else
			local v22 = p16.Min.X <= p17.X;
			if v19.Y < p16.Min.Y then
				return v22, Vector2.new(p16.Min.X, p16.Min.Y);
			elseif p16.Max.Y < v19.Y then
				return v22, Vector2.new(p16.Min.X, p16.Max.Y);
			else
				return v22, v3:snapMethod(p17, v19, v20, p16.Min.X, "Y", "X");
			end;
		end;
	end;
	if -v16.X * v14 <= v16.Y then
		local v23 = p17.X <= p16.Max.X;
		if v19.Y < p16.Min.Y then
			return v23, Vector2.new(p16.Max.X, p16.Min.Y);
		elseif p16.Max.Y < v19.Y then
			return v23, Vector2.new(p16.Max.X, p16.Max.Y);
		else
			return v23, v3:snapMethod(p17, v19, v20, p16.Max.X, "Y", "X");
		end;
	end;
	local v24 = p16.Min.Y <= p17.Y;
	if v19.X < p16.Min.X then
		return v24, Vector2.new(p16.Min.X, p16.Min.Y);
	end;
	if p16.Max.X < v19.X then
		return v24, Vector2.new(p16.Max.X, p16.Min.Y);
	end;
	return v24, v3:snapMethod(p17, v19, v20, p16.Min.Y, "X", "Y");
end;
function v3.centerBoundaryMethod(p18, p19, p20, p21)
	local v25 = (p19.Min + p19.Max) / 2;
	local v26 = p21 - v25;
	return v26.Magnitude < p20, v25 + v26.Unit * (p20 * math.sign(p21.Y));
end;
function v3.getIndicatorUi(p22)
	return p22.ui;
end;
function v3.getTargetPosition(p23)
	local l__attachTo__27 = p23.config.attachTo;
	if typeof(l__attachTo__27) == "Vector3" then
		return l__attachTo__27;
	end;
	if typeof(l__attachTo__27) ~= "Instance" then
		error("Unreachable");
		return;
	end;
	return l__attachTo__27.Position;
end;
local l__Players__3 = v2.Players;
local l__ConstraintType__4 = v1.import(script, script.Parent, "indicator-types").ConstraintType;
local l__MathExtras__5 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "util", "math-util").MathExtras;
function v3.update(p24)
	local v28 = p24:getIndicatorWorldPosition();
	local v29 = v3.camera.CFrame;
	local v30 = p24.config.uiConfig.distanceRelativeToPlayer;
	if v30 then
		local v31 = l__Players__3.LocalPlayer.Character;
		if v31 ~= nil then
			v31 = v31.PrimaryPart;
		end;
		v30 = v31 ~= nil;
	end;
	if v30 then
		v29 = l__Players__3.LocalPlayer.Character.PrimaryPart.CFrame;
	end;
	local v32 = v3.camera:WorldToScreenPoint(v28);
	local l__Z__33 = v32.Z;
	local v34 = Vector2.new(v32.X, v32.Y);
	local l__Magnitude__35 = (v29.Position - v28).Magnitude;
	local l__AbsolutePosition__36 = p24.boundaryUi.AbsolutePosition;
	local l__AbsoluteSize__37 = p24.boundaryUi.AbsoluteSize;
	if p24.config.constraintType == l__ConstraintType__4.Constrained then
		if l__Z__33 < 0 then
			v34 = l__AbsoluteSize__37 + l__AbsolutePosition__36 - v34 + l__AbsolutePosition__36;
		end;
		local v38, v39 = v3:screenBoundaryMethod(Rect.new(l__AbsolutePosition__36, l__AbsolutePosition__36 + l__AbsoluteSize__37), v34);
		if v38 and l__Z__33 >= 0 then
			v39 = v34;
		end;
		p24.boundaryUi.Visible = true;
		if l__AbsoluteSize__37.X < 0 then
			local v40 = -l__AbsoluteSize__37.X;
		else
			v40 = 0;
		end;
		if l__AbsoluteSize__37.Y < 0 then
			local v41 = -l__AbsoluteSize__37.Y;
		else
			v41 = 0;
		end;
		local v42 = Vector2.new(v40, v41);
		p24.ui.Position = UDim2.fromOffset(v39.X - l__AbsolutePosition__36.X + v42.X, v39.Y - l__AbsolutePosition__36.Y + v42.Y);
		if p24.arrow then
			p24.arrow.Visible = v34 ~= v39;
			if v34 ~= v39 then
				local v43 = v34 - v39;
				local v44 = math.deg(math.atan2(v43.Y, v43.X));
				if l__Z__33 < 0 and v38 then
					v44 = v44 + 180;
				end;
				p24.arrow.Rotation = v44;
			end;
		end;
	elseif p24.config.constraintType == l__ConstraintType__4.Hidden then
		if l__Z__33 < 0 then
			p24.ui.Visible = false;
		elseif v3:screenBoundaryMethod(Rect.new(l__AbsolutePosition__36, l__AbsolutePosition__36 + l__AbsoluteSize__37), v34) then
			p24.ui.Visible = true;
			p24.ui.Position = UDim2.fromOffset(v34.X - l__AbsolutePosition__36.X, v34.Y - l__AbsolutePosition__36.Y);
		else
			p24.ui.Visible = false;
		end;
		if p24.arrow then
			p24.arrow.Visible = false;
		end;
	elseif p24.config.constraintType == l__ConstraintType__4.Radial then
		local v45 = v29:VectorToObjectSpace(v28 - v29.Position);
		local v46 = Vector2.new(v45.X, v45.Z);
		local v47 = Rect.new(l__AbsolutePosition__36, l__AbsolutePosition__36 + l__AbsoluteSize__37);
		local v48 = (v47.Min + v47.Max) / 2 + v46.Unit * 150;
		if l__AbsoluteSize__37.X < 0 then
			local v49 = -l__AbsoluteSize__37.X;
		else
			v49 = 0;
		end;
		if l__AbsoluteSize__37.Y < 0 then
			local v50 = -l__AbsoluteSize__37.Y;
		else
			v50 = 0;
		end;
		local v51 = Vector2.new(v49, v50);
		p24.ui.Position = UDim2.fromOffset(v48.X - l__AbsolutePosition__36.X + v51.X, v48.Y - l__AbsolutePosition__36.Y + v51.Y);
		if p24.arrow then
			p24.arrow.Visible = true;
			p24.arrow.Rotation = math.deg(math.atan2(v46.Y, v46.X));
		end;
	end;
	local v52 = 1 - l__MathExtras__5:rangeMap(math.clamp(l__Magnitude__35, v3.DISTANCE_AT_INVISIBLE, v3.DISTANCE_AT_FULL_VISIBILITY), { v3.DISTANCE_AT_INVISIBLE, v3.DISTANCE_AT_FULL_VISIBILITY }, { 0, 1 });
	local v53 = l__MathExtras__5:easeInQuad(v52);
	if p24.config.uiConfig.easeOutOnAppoach == nil then
		local v54 = true;
	else
		v54 = p24.config.uiConfig.easeOutOnAppoach;
	end;
	if v54 then
		local v55 = v52;
	else
		v55 = 0;
	end;
	p24:updateProperties(l__Magnitude__35, v55, v53);
	if p24.config.onUpdateProperties then
		if v54 then
			local v56 = v52;
		else
			v56 = 0;
		end;
		p24.config.onUpdateProperties(l__Magnitude__35, v56, v53, p24.ui, p24.config.creator);
	end;
end;
function v3.getIndicatorWorldPosition(p25)
	local l__attachTo__57 = p25.config.attachTo;
	if typeof(l__attachTo__57) == "Vector3" then
		return l__attachTo__57;
	end;
	if l__attachTo__57:IsA("Attachment") then
		return l__attachTo__57.WorldPosition;
	end;
	return l__attachTo__57.Position;
end;
local u6 = v1.import(script, v1.getModule(script, "@rbxts", "make"));
function v3.createUi(p26)
	local v58 = u6("Frame", {
		AnchorPoint = Vector2.new(0.5, 0.5), 
		Size = v3.BASE_INDICATOR_SIZE, 
		BackgroundTransparency = 1, 
		Parent = p26.boundaryUi, 
		Children = { u6("UICorner", {
				CornerRadius = UDim.new(1, 0)
			}), u6("UIAspectRatioConstraint", {
				AspectRatio = 1, 
				AspectType = Enum.AspectType.ScaleWithParentSize, 
				DominantAxis = Enum.DominantAxis.Height
			}) }
	});
	if type(p26.config.uiConfig.color3) == "function" then
		local v59 = p26.config.uiConfig.color3(0);
	else
		v59 = p26.config.uiConfig.color3;
	end;
	local v60 = {
		AnchorPoint = Vector2.new(0.5, 0.5), 
		Position = UDim2.fromScale(0.5, 0.5), 
		Size = UDim2.fromScale(1, 1), 
		BackgroundTransparency = 1, 
		Parent = v58
	};
	local v61 = {
		AnchorPoint = Vector2.new(0, 0.5), 
		Position = UDim2.fromScale(1, 0.5), 
		Size = UDim2.fromScale(1, 0.6), 
		BackgroundTransparency = 1
	};
	local v62 = p26.config.arrowImage;
	if v62 == nil then
		v62 = "rbxassetid://9192635632";
	end;
	v61.Image = v62;
	v61.ImageColor3 = v59;
	v61.Children = { u6("UIAspectRatioConstraint", {
			AspectRatio = 0.5, 
			AspectType = Enum.AspectType.ScaleWithParentSize, 
			DominantAxis = Enum.DominantAxis.Height
		}) };
	v60.Children = { u6("ImageLabel", v61) };
	p26.arrow = u6("Frame", v60);
	return p26:mountUi(v58);
end;
function v3.destroy(p27)
	p27.maid:Destroy();
end;
function v3.Destroy(p28)
	p28:destroy();
end;
v3.BASE_INDICATOR_SIZE = UDim2.fromScale(0, 0.065);
v3.DISTANCE_AT_FULL_VISIBILITY = 30;
v3.DISTANCE_AT_INVISIBLE = 15;
v3.camera = v2.Workspace.CurrentCamera;
return {
	ActiveWorldIndicator = v3
};
