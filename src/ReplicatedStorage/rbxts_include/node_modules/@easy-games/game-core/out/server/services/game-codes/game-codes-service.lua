
-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local l__Reflect__2 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Reflect;
local v3 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "game-core-networking");
local v4 = setmetatable({}, {
	__tostring = function()
		return "GameCodesService";
	end
});
v4.__index = v4;
function v4.new(...)
	local v5 = setmetatable({}, v4);
	return v5:constructor(...) and v5;
end;
local l__ExpireList__1 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "object", "expire-list").ExpireList;
function v4.constructor(p1)
	p1.rateLimiter = l__ExpireList__1.new(1);
end;
local l__GameCoreNetFunctions__2 = v3.GameCoreNetFunctions;
local l__ColorUtil__3 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "util", "color-util").ColorUtil;
local l__GameTheme__4 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "ui", "game-theme").GameTheme;
local l__GameCoreNetEvents__5 = v3.GameCoreNetEvents;
function v4.onStart(p2)
	l__GameCoreNetFunctions__2.server.redeemCode:setCallback(function(p3, p4)
		if p2.rateLimiter:has(p3.UserId) then
			return {
				success = false, 
				errorMessage = "<font color=\"" .. l__ColorUtil__3.richTextColor(l__GameTheme__4.backgroundError) .. "\"><b>\240\159\154\171 Error:</b></font> You've made to many requests. Please slow down a bit!"
			};
		end;
		p2.rateLimiter:add(p3.UserId);
		local l__codeManager__6 = p2.codeManager;
		if l__codeManager__6 then
			return l__codeManager__6:redeemCode(p3, p4);
		end;
		warn("No code manager connected. Check connectCodeManager()");
		return {
			success = false, 
			errorMessage = "Code manager setup error. Contact a dev."
		};
	end);
	l__GameCoreNetEvents__5.server.requestCodeGenUpdate:connect(function(p5)
		p2:sendCodeGenUpdate(p5);
	end);
	l__GameCoreNetFunctions__2.server.regenCodeGenerator:setCallback(function(p6, p7)
		if p2.rateLimiter:has(p6.UserId) then
			return {
				success = false, 
				errorMessage = "<font color=\"" .. l__ColorUtil__3.richTextColor(l__GameTheme__4.backgroundError) .. "\"><b>\240\159\154\171 Error:</b></font> You've made to many requests. Please slow down a bit!"
			};
		end;
		p2.rateLimiter:add(p6.UserId);
		local l__codeManager__7 = p2.codeManager;
		if not l__codeManager__7 then
			warn("No code manager connected. Check connectCodeManager()");
			return {
				success = false, 
				errorMessage = "Code manager setup error. Contact a dev."
			};
		end;
		local v8 = l__codeManager__7:getCodeGenerator(p7);
		if not v8 then
			return {
				success = false, 
				errorMessage = "\240\159\154\171 Error: This is not a valid code generator"
			};
		end;
		if not v8:hasPermission(p6.UserId) then
			return {
				success = false, 
				errorMessage = "\240\159\154\171 Error: You don't have permission to use this code generator"
			};
		end;
		return v8:generateCodes(p6.UserId);
	end);
end;
function v4.connectCodeManager(p8, p9)
	p8.codeManager = p9;
end;
function v4.getCodeManager(p10)
	return p10.codeManager;
end;
local l__Players__6 = v1.import(script, v1.getModule(script, "@rbxts", "services")).Players;
function v4.sendCodeGenUpdate(p11, p12)
	if type(p12) == "number" then
		local v9 = l__Players__6:GetPlayerByUserId(p12);
		if not v9 then
			return nil;
		end;
		p12 = v9;
	end;
	local l__codeManager__10 = p11.codeManager;
	if l__codeManager__10 then
		local v11 = l__codeManager__10:getPlayerCodeGenInfo(p12);
		if next(v11) ~= nil then
			l__GameCoreNetEvents__5.server.sendCodeGenUpdate:fire(p12, {
				codeGenerators = v11
			});
		end;
	end;
end;
l__Reflect__2.defineMetadata(v4, "identifier", "@easy-games/game-core:server/services/game-codes/game-codes-service@GameCodesService");
l__Reflect__2.defineMetadata(v4, "flamework:isExternal", false);
l__Reflect__2.defineMetadata(v4, "flamework:implements", { "$:flamework@OnStart" });
l__Reflect__2.defineMetadata(v4, "flamework:decorators", { "$:flamework@Service" });
l__Reflect__2.defineMetadata(v4, "flamework:decorators.$:flamework@Service", {
	type = "Service"
});
return {
	GameCodesService = v4
};

