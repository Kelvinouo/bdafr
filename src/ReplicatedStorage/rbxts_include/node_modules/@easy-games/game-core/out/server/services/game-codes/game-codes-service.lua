-- Script Hash: c685c336ce79df27a0e6dea8e0779137f82713b0eb684f56738d40acea6742b87067a8029da17ef2addd6531dd53fb5f
-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local l__Reflect__2 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Reflect;
local l__Service__3 = v1.import(script, v1.getModule(script, "@flamework", "core").out).Service;
local v4 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "game-core-networking");
local v5 = setmetatable({}, {
	__tostring = function()
		return "GameCodesService";
	end
});
v5.__index = v5;
function v5.new(...)
	local v6 = setmetatable({}, v5);
	return v6:constructor(...) and v6;
end;
local l__ExpireList__1 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "object", "expire-list").ExpireList;
function v5.constructor(p1)
	p1.rateLimiter = l__ExpireList__1.new(1);
end;
local l__GameCoreNetFunctions__2 = v4.GameCoreNetFunctions;
local l__ColorUtil__3 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "util", "color-util").ColorUtil;
local l__GameTheme__4 = v1.import(script, script.Parent.Parent.Parent.Parent, "shared", "ui", "game-theme").GameTheme;
local l__GameCoreNetEvents__5 = v4.GameCoreNetEvents;
function v5.onStart(p2)
	l__GameCoreNetFunctions__2.server.redeemCode:setCallback(function(p3, p4)
		if p2.rateLimiter:has(p3.UserId) then
			return {
				success = false, 
				errorMessage = "<font color=\"" .. l__ColorUtil__3.richTextColor(l__GameTheme__4.backgroundError) .. "\"><b>\240\159\154\171 Error:</b></font> You've made to many requests. Please slow down a bit!"
			};
		end;
		p2.rateLimiter:add(p3.UserId);
		local l__codeManager__7 = p2.codeManager;
		if l__codeManager__7 then
			return l__codeManager__7:redeemCode(p3, p4);
		end;
		warn("No code manager connected. Check connectCodeManager()");
		return {
			success = false, 
			errorMessage = "Code manager setup error. Contact a dev."
		};
	end);
	l__GameCoreNetEvents__5.server.requestCodeGenUpdate:connect(function(p5)
		p2:sendCodeGenUpdate(p5);
	end);
	l__GameCoreNetFunctions__2.server.regenCodeGenerator:setCallback(function(p6, p7)
		if p2.rateLimiter:has(p6.UserId) then
			return {
				success = false, 
				errorMessage = "<font color=\"" .. l__ColorUtil__3.richTextColor(l__GameTheme__4.backgroundError) .. "\"><b>\240\159\154\171 Error:</b></font> You've made to many requests. Please slow down a bit!"
			};
		end;
		p2.rateLimiter:add(p6.UserId);
		local l__codeManager__8 = p2.codeManager;
		if not l__codeManager__8 then
			warn("No code manager connected. Check connectCodeManager()");
			return {
				success = false, 
				errorMessage = "Code manager setup error. Contact a dev."
			};
		end;
		local v9 = l__codeManager__8:getCodeGenerator(p7);
		if not v9 then
			return {
				success = false, 
				errorMessage = "\240\159\154\171 Error: This is not a valid code generator"
			};
		end;
		if not v9:hasPermission(p6.UserId) then
			return {
				success = false, 
				errorMessage = "\240\159\154\171 Error: You don't have permission to use this code generator"
			};
		end;
		return v9:generateCodes(p6.UserId);
	end);
end;
function v5.connectCodeManager(p8, p9)
	p8.codeManager = p9;
end;
function v5.getCodeManager(p10)
	return p10.codeManager;
end;
local l__Players__6 = v1.import(script, v1.getModule(script, "@rbxts", "services")).Players;
function v5.sendCodeGenUpdate(p11, p12)
	if type(p12) == "number" then
		local v10 = l__Players__6:GetPlayerByUserId(p12);
		if not v10 then
			return nil;
		end;
		p12 = v10;
	end;
	local l__codeManager__11 = p11.codeManager;
	if l__codeManager__11 then
		local v12 = l__codeManager__11:getPlayerCodeGenInfo(p12);
		if next(v12) ~= nil then
			l__GameCoreNetEvents__5.server.sendCodeGenUpdate:fire(p12, {
				codeGenerators = v12
			});
		end;
	end;
end;
l__Reflect__2.defineMetadata(v5, "identifier", "@easy-games/game-core:server/services/game-codes/game-codes-service@GameCodesService");
l__Reflect__2.defineMetadata(v5, "flamework:implements", { "$:flamework@OnStart" });
l__Reflect__2.decorate(v5, "$:flamework@Service", l__Service__3, { {} });
return {
	GameCodesService = v5
};
