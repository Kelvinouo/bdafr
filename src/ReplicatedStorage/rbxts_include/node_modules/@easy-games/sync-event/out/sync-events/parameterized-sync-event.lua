-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, script.Parent.Parent, "event-template");
local v3 = v1.import(script, script.Parent.Parent, "sync-event-priority");
local l__EventTemplate__4 = v2.EventTemplate;
local v5 = setmetatable({}, {
	__tostring = function()
		return "ParameterizedSyncEvent";
	end, 
	__index = l__EventTemplate__4
});
v5.__index = v5;
function v5.new(...)
	local v6 = setmetatable({}, v5);
	return v6:constructor(...) and v6;
end;
local u1 = l__EventTemplate__4;
function v5.constructor(p1, ...)
	u1.constructor(p1, ...);
	p1.entries = {};
	p1.listenedParameters = {};
end;
local l__SyncEventPriority__2 = v3.SyncEventPriority;
local l__HttpService__3 = v1.import(script, v1.getModule(script, "@rbxts", "services")).HttpService;
local l__MapUtil__4 = v1.import(script, v1.getModule(script, "@easy-games", "data-structure").out).MapUtil;
local l__EventConnection__5 = v2.EventConnection;
function v5.connect(p2, p3, p4, p5, p6)
	if p5 == nil then
		p5 = l__SyncEventPriority__2.NORMAL;
	end;
	if p6 == nil then
		p6 = 0;
	end;
	local v7 = l__HttpService__3:GenerateGUID(false);
	local v8 = p4;
	if v8 == nil then
		v8 = {};
	end;
	local v9 = p2:encodeParameters(v8, true);
	local v10 = l__MapUtil__4.getOrCreate(p2.entries, v9, {});
	v10[v7] = {
		priority = p5, 
		callbackInfo = {
			callback = p3, 
			callingThreadInfo = p2:getCallingThreadInfo(p6)
		}
	};
	return l__EventConnection__5.new(function()
		v10[v7] = nil;
		local v11 = 0;
		for v12, v13 in pairs(v10) do
			v11 = v11 + 1;
		end;
		if v11 == 0 then
			p2.entries[v9] = nil;
		end;
	end);
end;
local l__SyncEventPriorityOrdered__6 = v3.SyncEventPriorityOrdered;
function v5.fire(p7, ...)
	local v14 = p7:constructEvent({ ... });
	local v15 = {};
	for v16, v17 in ipairs(l__MapUtil__4.values(p7.listenedParameters)) do
		local v18 = p7.entries[p7:encodeParameters(p7:reduceParameters(v14:getParameters(), v17), false)];
		if v18 then
			for v19, v20 in ipairs(l__MapUtil__4.values(v18)) do
				table.insert(l__MapUtil__4.getOrCreate(v15, v20.priority, {}), v20);
			end;
		end;
	end;
	local v21, v22, v23 = ipairs(l__SyncEventPriorityOrdered__6);
	while true do
		local v24, v25 = v21(v22, v23);
		if not v24 then
			break;
		end;
		for v26, v27 in ipairs(v15[v25] or {}) do
			p7:wrapCallback(v27.callbackInfo.callingThreadInfo, function()
				v27.callbackInfo.callback(v14);
			end);
		end;	
	end;
	return v14;
end;
function v5.reduceParameters(p8, p9, p10)
	local v28 = {};
	for v29, v30 in ipairs(p10) do
		v28[v30] = p9[v30];
	end;
	return v28;
end;
local u7 = v1.import(script, v1.getModule(script, "@rbxts", "object-utils"));
function v5.quickInspect(p11, p12)
	local v31 = {};
	for v32, v33 in ipairs(u7.keys(p12)) do
		table.insert(v31, v33);
		table.insert(v31, "::");
		table.insert(v31, (tostring(p12[v33])));
	end;
	return table.concat(v31, "");
end;
function v5.encodeParameters(p13, p14, p15)
	local v34 = u7.keys(p14);
	table.sort(v34);
	if p15 then
		p13.listenedParameters[p13:quickInspect(v34)] = v34;
	end;
	local v35 = {};
	for v36, v37 in ipairs(v34) do
		table.insert(v35, v37);
		table.insert(v35, p14[v37]);
	end;
	return p13:quickInspect(v35);
end;
local u8 = nil;
function v5.setParameters(p16, p17)
	return u8.new(p16):setParameters(p17);
end;
function v5.setPriority(p18, p19)
	return u8.new(p18):setPriority(p19);
end;
u1 = setmetatable;
u1 = u1({}, {
	__tostring = function()
		return "ParameterizedSyncEventBuilder";
	end
});
u8 = u1;
u8.__index = u8;
u1 = function(...)
	local v38 = setmetatable({}, u8);
	return v38:constructor(...) and v38;
end;
u8.new = u1;
u1 = function(p20, p21)
	p20.eventObject = p21;
end;
u8.constructor = u1;
u1 = function(p22, p23)
	p22.parameters = p23;
	return p22;
end;
u8.setParameters = u1;
u1 = function(p24, p25)
	p24.priority = p25;
	return p24;
end;
u8.setPriority = u1;
u1 = function(p26, p27)
	return p26.eventObject:connect(p27, p26.parameters, p26.priority, 1);
end;
u8.connect = u1;
u1 = function(p28, ...)
	return p28.eventObject:fire(unpack({ ... }));
end;
u8.fire = u1;
u1 = {
	ParameterizedSyncEvent = v5
};
return l__EventTemplate__4;
