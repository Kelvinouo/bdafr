-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, v1.getModule(script, "@easy-games", "game-core").out);
local v3 = v1.import(script, v1.getModule(script, "@rbxts", "services"));
local v4 = setmetatable({}, {
	__tostring = function()
		return "BlockPlacer";
	end
});
v4.__index = v4;
function v4.new(...)
	local v5 = setmetatable({}, v4);
	return v5:constructor(...) and v5;
end;
local u1 = v1.import(script, v1.getModule(script, "@rbxts", "maid").Maid);
local u2 = v1.import(script, v1.getModule(script, "@rbxts", "signal"));
local l__BlockHighlighter__3 = v1.import(script, script.Parent.Parent, "highlight", "block-highlighter").BlockHighlighter;
local l__BlockSelectorMode__4 = v1.import(script, script.Parent.Parent, "select", "block-selector").BlockSelectorMode;
local l__BlockEngineRemotes__5 = v1.import(script, script.Parent.Parent.Parent, "remotes").BlockEngineRemotes;
local l__Players__6 = v3.Players;
function v4.constructor(p1, p2, p3)
	p1.clientManager = p2;
	p1.blockType = p3;
	p1.maid = u1.new();
	p1.onPlace = u2.new();
	p1.blockHighlighter = l__BlockHighlighter__3.new(p1.clientManager, l__BlockSelectorMode__4.PLACE);
	l__BlockEngineRemotes__5.Client:WaitFor("RemoteName"):andThen(function(p4)
		p4:Connect(function(p5)
			if p5.player ~= l__Players__6.LocalPlayer then
				p1:playPlaceEffect(p5.blockRef, p5.blockType, p5.player);
			end;
		end);
	end);
end;
local l__BlockEngine__7 = v1.import(script, script.Parent.Parent.Parent).BlockEngine;
local l__RandomUtil__8 = v2.RandomUtil;
local l__SoundManager__9 = v2.SoundManager;
function v4.playPlaceEffect(p6, p7, p8, p9)
	if l__Players__6.LocalPlayer:DistanceFromCharacter(l__BlockEngine__7:getWorldPosition(p7.blockPosition)) < 50 then
		local v6 = l__BlockEngine__7:getHandlerRegistry():getHandler(p8);
		if v6 ~= nil then
			v6 = v6:getBlockMeta();
		end;
		if v6 and v6.placeSound ~= nil then
			local v7 = {};
			if l__Players__6.LocalPlayer == p9 then
				local v8 = nil;
			else
				v8 = l__BlockEngine__7:getWorldPosition(p7.blockPosition);
			end;
			v7.position = v8;
			l__SoundManager__9:playSound(l__RandomUtil__8.fromList(unpack(v6.placeSound())), v7);
		end;
	end;
end;
local l__BlockEngineClientEvents__10 = v1.import(script, script.Parent.Parent, "block-engine-client-events").BlockEngineClientEvents;
local l__AnimationUtil__11 = v2.AnimationUtil;
local l__AnimationId__12 = v1.import(script, script.Parent.Parent.Parent, "shared", "animation", "animation-id").AnimationId;
function v4.placeBlock(p10, p11)
	if not l__BlockEngine__7:isAllowedPlacement(l__Players__6.LocalPlayer, p10.blockType, p11, 0) then
		return nil;
	end;
	if l__BlockEngineClientEvents__10.PlaceBlock:fire(p10.blockType, p11):isCancelled() then
		return nil;
	end;
	if l__Players__6.LocalPlayer:GetAttribute("DenyBlockPlace") == true then
		return nil;
	end;
	local v9 = l__BlockEngine__7:placeBlock(p10.blockType, p11, {
		player = l__Players__6.LocalPlayer, 
		skipCulling = true
	});
	local u13 = l__AnimationUtil__11.playAnimation(l__Players__6.LocalPlayer, l__BlockEngine__7:getAnimationController():getAssetId(l__AnimationId__12.PLACE_BLOCK));
	p10.maid:GiveTask(function()
		if u13 ~= nil then
			u13:Stop();
		end;
		if u13 ~= nil then
			u13:Destroy();
		end;
	end);
	p10.onPlace:Fire();
	if v9 then
		p10:playPlaceEffect({
			blockPosition = p11
		}, p10.blockType, l__Players__6.LocalPlayer);
	end;
	v1.try(function()
		l__BlockEngineRemotes__5.Client:Get("RemoteName"):CallServer({
			blockType = p10.blockType, 
			position = p11
		});
	end, function(p12)
		warn("Failed block placement:", p12);
	end);
	if v9 then
		l__BlockEngine__7:getStore():removeBlockInstance(v9);
		v9:Destroy();
	end;
end;
local l__UserInputService__14 = v3.UserInputService;
local l__Workspace__15 = v3.Workspace;
local l__ContextActionService__16 = v3.ContextActionService;
function v4.enable(p13)
	p13.blockHighlighter:enable();
	p13.maid:GiveTask(function()
		p13.blockHighlighter:disable();
	end);
	p13.maid:GiveTask(l__UserInputService__14.TouchTapInWorld:Connect(function(p14, p15)
		if p15 then
			return nil;
		end;
		local v10 = p13.clientManager:getBlockSelector():getMouseInfo(l__BlockSelectorMode__4.PLACE, {
			ray = l__Workspace__15.CurrentCamera:ViewportPointToRay(p14.X, p14.Y)
		});
		if v10 then
			p13:placeBlock(v10.placementPosition);
		end;
	end));
	l__ContextActionService__16:BindAction("block-place", function(p16, p17, p18)
		if p17 ~= Enum.UserInputState.Begin then
			return nil;
		end;
		local v11 = p13.clientManager:getBlockSelector():getMouseInfo(l__BlockSelectorMode__4.PLACE);
		if v11 then
			p13:placeBlock(v11.placementPosition);
		end;
	end, false, Enum.UserInputType.MouseButton1);
	p13.maid:GiveTask(function()
		l__ContextActionService__16:UnbindAction("block-place");
	end);
end;
local u17 = v2.ConstantManager.registerConstants(script, {
	AUTOBRIDGE_Y_OFFSET = 3
});
local l__BLOCK_SIZE__18 = v1.import(script, script.Parent.Parent.Parent, "shared", "block", "block-constants").BLOCK_SIZE;
function v4.autoBridge(p19, p20)
	if p20 == nil then
		p20 = true;
	end;
	local l__Character__12 = l__Players__6.LocalPlayer.Character;
	local v13 = l__Character__12;
	if v13 ~= nil then
		v13 = v13.PrimaryPart;
	end;
	if not v13 then
		return nil;
	end;
	local v14 = l__Character__12:FindFirstChild("Humanoid");
	if v14 ~= nil then
		v14 = v14.MoveDirection;
	end;
	local v15 = v14;
	if v15 == nil then
		v15 = Vector3.new(0, 0, 0);
	end;
	local v16 = v15 * Vector3.new(1, 0, 1);
	if v16.Magnitude ~= 0 then
		local v17 = CFrame.new(Vector3.new(0, 0, 0), v16);
	else
		v17 = v13.CFrame;
	end;
	if l__Workspace__15.CurrentCamera and math.deg((l__Workspace__15.CurrentCamera.CFrame:ToOrientation())) < -65 then
		local v18 = l__Character__12.PrimaryPart;
		if v18 ~= nil then
			v18 = v18.Position;
		end;
		if not v18 then
			return nil;
		end;
		local v19 = { Vector3.new(1, 0, 0), Vector3.new(-1, 0, 0), Vector3.new(0, 0, 1), Vector3.new(0, 0, -1), Vector3.new(1, 0, 1), Vector3.new(-1, 0, -1), Vector3.new(-1, 0, 1), Vector3.new(1, 0, -1), Vector3.new(0, -1, 0) };
		local v20 = 0;
		local v21 = false;
		while true do
			if v21 then
				v20 = v20 + 1;
			else
				v21 = true;
			end;
			if not (v20 <= 3) then
				break;
			end;
			local v22 = l__BlockEngine__7:getBlockPosition(v18 - Vector3.new(0, l__BLOCK_SIZE__18, 0) * v20);
			for v23, v24 in ipairs(v19) do
				if l__BlockEngine__7:getStore():getBlockAt(v22 + v24) ~= nil then
					p19:placeBlock(v22);
					return nil;
				end;
			end;		
		end;
	end;
	local v25 = p19.clientManager:getBlockSelector():getMouseInfo(l__BlockSelectorMode__4.PLACE, {
		ray = Ray.new(v13.CFrame.Position + Vector3.new(0, u17.AUTOBRIDGE_Y_OFFSET, 0), (v17 * CFrame.Angles(math.rad(-15), 0, 0)).LookVector), 
		searchOutward = true, 
		allowVoidSave = p20
	});
	if v25 then
		p19:placeBlock(v25.placementPosition);
	end;
end;
function v4.disable(p21)
	p21.maid:DoCleaning();
end;
function v4.getBlockType(p22)
	return p22.blockType;
end;
return {
	BlockPlacer = v4
};
