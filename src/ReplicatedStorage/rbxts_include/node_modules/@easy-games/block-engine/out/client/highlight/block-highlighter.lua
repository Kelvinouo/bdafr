-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, v1.getModule(script, "@rbxts", "services"));
local v3 = setmetatable({}, {
	__tostring = function()
		return "BlockHighlighter";
	end
});
v3.__index = v3;
function v3.new(...)
	local v4 = setmetatable({}, v3);
	return v4:constructor(...) and v4;
end;
local u1 = v1.import(script, v1.getModule(script, "@rbxts", "maid").Maid);
function v3.constructor(p1, p2, p3)
	p1.clientManager = p2;
	p1.mode = p3;
	p1.maid = u1.new();
end;
local l__HttpService__2 = v2.HttpService;
local l__RunService__3 = v2.RunService;
local l__Workspace__4 = v2.Workspace;
local l__BlockEngine__5 = v1.import(script, script.Parent.Parent.Parent).BlockEngine;
local l__BlockSelectorMode__6 = v1.import(script, script.Parent.Parent, "select", "block-selector").BlockSelectorMode;
local l__PositionUtil__7 = v1.import(script, script.Parent.Parent.Parent, "shared", "lib", "position-util").PositionUtil;
local l__BLOCK_SIZE__8 = v1.import(script, script.Parent.Parent.Parent, "shared", "block", "block-constants").BLOCK_SIZE;
local u9 = v1.import(script, v1.getModule(script, "@rbxts", "make"));
local l__GameQueryUtil__10 = v1.import(script, v1.getModule(script, "@easy-games", "game-core").out).GameQueryUtil;
function v3.enable(p4)
	local u11 = u1.new();
	local u12 = nil;
	local function v5()
		u11:DoCleaning();
		u11:GiveTask(function()
			if u12 then
				if p4.onHighlightEnded then
					u11:GiveTask(function()
						p4.onHighlightEnded();
					end);
				end;
				u12 = nil;
			end;
		end);
	end;
	v5();
	local v6 = "block-place-highlight:" .. l__HttpService__2:GenerateGUID(false);
	local u13 = nil;
	l__RunService__3:BindToRenderStep(v6, Enum.RenderPriority.Last.Value, function(p5)
		local v7 = nil;
		if p4.registeredInputObject and l__Workspace__4.CurrentCamera then
			if p4.registeredInputObject.UserInputState ~= Enum.UserInputState.End then
				v7 = l__Workspace__4.CurrentCamera:ScreenPointToRay(p4.registeredInputObject.Position.X, p4.registeredInputObject.Position.Y);
			else
				p4.registeredInputObject = nil;
			end;
		end;
		local v8 = p4.clientManager:getBlockSelector():getMouseInfo(p4.mode, {
			ray = v7
		});
		if v8 and v8.target then
			local l__blockPosition__9 = v8.target.blockRef.blockPosition;
			local v10 = l__BlockEngine__5:getStore():getBlockAt(v8.target.blockRef.blockPosition);
			if p4.allowHighlight and not p4.allowHighlight(v10, l__blockPosition__9) then
				v5();
				return nil;
			end;
			local v11 = u12;
			if v11 ~= nil then
				v11 = v11.blockPosition;
			end;
			if v8.target.blockRef.blockPosition ~= v11 then
				local v12 = nil;
				local v13 = nil;
				local v14 = nil;
				local v15 = nil;
				local v16 = nil;
				local v17 = nil;
				local v18 = nil;
				local v19 = nil;
				local v20 = nil;
				local v21 = nil;
				local v22 = nil;
				local v23 = nil;
				local v24 = nil;
				local v25 = nil;
				local v26 = nil;
				local v27 = nil;
				local v28 = nil;
				local v29 = nil;
				local v30 = nil;
				local v31 = nil;
				local v32 = nil;
				local v33 = nil;
				local v34 = nil;
				local v35 = nil;
				local v36 = nil;
				local v37 = nil;
				local v38 = nil;
				local v39 = nil;
				local v40 = nil;
				local v41 = nil;
				local v42 = nil;
				local v43 = nil;
				local v44 = nil;
				local v45 = nil;
				local v46 = nil;
				local v47 = nil;
				local v48 = nil;
				local v49 = nil;
				local v50 = nil;
				local v51 = nil;
				local v52 = nil;
				local v53 = nil;
				local v54 = nil;
				local v55 = nil;
				local v56 = nil;
				local v57 = nil;
				local v58 = nil;
				local v59 = nil;
				local v60 = nil;
				local v61 = nil;
				local v62 = nil;
				local v63 = nil;
				local v64 = nil;
				local v65 = nil;
				local v66 = nil;
				local v67 = nil;
				local v68 = nil;
				local v69 = nil;
				local v70 = nil;
				local v71 = nil;
				local v72 = nil;
				local v73 = nil;
				local v74 = nil;
				local v75 = nil;
				local v76 = nil;
				local v77 = nil;
				local v78 = nil;
				local v79 = nil;
				local v80 = nil;
				local v81 = nil;
				local v82 = nil;
				local v83 = nil;
				local v84 = nil;
				local v85 = nil;
				local v86 = nil;
				local v87 = nil;
				local v88 = nil;
				local v89 = nil;
				local v90 = nil;
				local v91 = nil;
				local v92 = nil;
				local v93 = nil;
				local v94 = nil;
				local v95 = nil;
				local v96 = nil;
				local v97 = nil;
				local v98 = nil;
				local u14 = nil;
				local v99 = nil;
				local v100 = nil;
				local v101 = nil;
				local v102 = nil;
				local v103 = nil;
				local v104 = nil;
				v5();
				u12 = v8.target.blockRef;
				u13 = v8.target.blockRef.blockPosition;
				local v105 = 0;
				if v10 then
					local v106 = v10;
					if v106 ~= nil then
						v106 = v106.Name;
					end;
					local v107 = l__BlockEngine__5:getHandlerRegistry():getHandler(v106);
					if v107 ~= nil then
						v107 = v107:getBlockMeta();
					end;
					if p4.mode == l__BlockSelectorMode__6.PLACE then
						local v108 = v107;
						if v108 ~= nil then
							v108 = v108.denyPlaceOn;
						end;
						if v108 then
							return nil;
						else
							local v109 = v107;
							if v109 ~= nil then
								v109 = v109.raisedHeight;
							end;
							if v109 ~= nil then
								v105 = v107.raisedHeight;
							end;
							v12 = p4;
							v13 = "onHighlight";
							v14 = v12;
							v15 = v13;
							v16 = v14[v15];
							v17 = v16;
							if v17 then
								p4.onHighlight(v10, l__blockPosition__9);
							end;
							local v110 = {};
							v18 = l__PositionUtil__7;
							local v111 = "convertToWorldPosition";
							v19 = v18;
							v20 = v111;
							local v112 = v19[v20];
							v21 = l__blockPosition__9;
							local v113 = v21;
							v22 = v112;
							v23 = v113;
							local v114 = v22(v23);
							v26 = 0;
							local v115 = 2;
							v24 = v105;
							v25 = v115;
							v27 = v24 / v25;
							v28 = 0;
							local v116 = Vector3.new;
							v29 = v116;
							v30 = v26;
							v31 = v27;
							v32 = v28;
							local v117 = v29(v30, v31, v32);
							local v118 = CFrame.new;
							v33 = v114;
							v34 = v117;
							local v119 = v33 + v34;
							v35 = v118;
							v36 = v119;
							local v120 = v35(v36);
							local v121 = "CFrame";
							v37 = v110;
							v38 = v121;
							v39 = v120;
							v37[v38] = v39;
							local v122 = l__BLOCK_SIZE__8;
							v40 = l__BLOCK_SIZE__8;
							v41 = v40;
							v42 = v105;
							local v123 = v41 + v42;
							local v124 = l__BLOCK_SIZE__8;
							local v125 = Vector3.new;
							v43 = v125;
							v44 = v122;
							v45 = v123;
							v46 = v124;
							local v126 = v43(v44, v45, v46);
							local v127 = "Size";
							v47 = v110;
							v48 = v127;
							v49 = v126;
							v47[v48] = v49;
							local v128 = true;
							local v129 = "Anchored";
							v50 = v110;
							v51 = v129;
							v52 = v128;
							v50[v51] = v52;
							local v130 = false;
							local v131 = "CanCollide";
							v53 = v110;
							v54 = v131;
							v55 = v130;
							v53[v54] = v55;
							local v132 = 1;
							local v133 = "Transparency";
							v56 = v110;
							v57 = v133;
							v58 = v132;
							v56[v57] = v58;
							local v134 = l__Workspace__4;
							local v135 = "Parent";
							v59 = v110;
							v60 = v135;
							v61 = v134;
							v59[v60] = v61;
							local v136 = u9;
							local v137 = "Part";
							v62 = v110;
							local v138 = v62;
							v63 = v136;
							v64 = v137;
							v65 = v138;
							local v139 = v63(v64, v65);
							local v140 = l__GameQueryUtil__10;
							v66 = v139;
							local v141 = v66;
							local v142 = "setQueryIgnored";
							v67 = v140;
							local v143 = v67;
							v68 = v140;
							v69 = v142;
							local v144 = v68[v69];
							v70 = v144;
							v71 = v143;
							v72 = v141;
							v70(v71, v72);
							local v145 = u9;
							local v146 = "SelectionBox";
							local v147 = {};
							local v148 = "Adornee";
							v73 = v147;
							v74 = v148;
							v75 = v139;
							v73[v74] = v75;
							local v149 = "Parent";
							v76 = v147;
							v77 = v149;
							v78 = v139;
							v76[v77] = v78;
							v79 = Color3.fromRGB;
							v80 = 0;
							v81 = 0;
							v82 = 0;
							v83 = v79;
							v84 = v80;
							v85 = v81;
							v86 = v82;
							local v150 = v83(v84, v85, v86);
							local v151 = "Color3";
							v87 = v147;
							v88 = v151;
							v89 = v150;
							v87[v88] = v89;
							local v152 = 0.04;
							local v153 = "LineThickness";
							v90 = v147;
							v91 = v153;
							v92 = v152;
							v90[v91] = v92;
							local v154 = 0;
							local v155 = "Transparency";
							v93 = v147;
							v94 = v155;
							v95 = v154;
							v93[v94] = v95;
							v96 = v145;
							v97 = v146;
							v98 = v147;
							v96(v97, v98);
							local v156 = u11;
							u14 = v139;
							local v157 = function()
								u14:Destroy();
							end;
							local v158 = "GiveTask";
							v99 = v156;
							local v159 = v99;
							v100 = v156;
							v101 = v158;
							local v160 = v100[v101];
							v102 = v160;
							v103 = v159;
							v104 = v157;
							v102(v103, v104);
							return;
						end;
					else
						v109 = v107;
						if v109 ~= nil then
							v109 = v109.raisedHeight;
						end;
						if v109 ~= nil then
							v105 = v107.raisedHeight;
						end;
						v12 = p4;
						v13 = "onHighlight";
						v14 = v12;
						v15 = v13;
						v16 = v14[v15];
						v17 = v16;
						if v17 then
							p4.onHighlight(v10, l__blockPosition__9);
						end;
						v110 = {};
						v18 = l__PositionUtil__7;
						v111 = "convertToWorldPosition";
						v19 = v18;
						v20 = v111;
						v112 = v19[v20];
						v21 = l__blockPosition__9;
						v113 = v21;
						v22 = v112;
						v23 = v113;
						v114 = v22(v23);
						v26 = 0;
						v115 = 2;
						v24 = v105;
						v25 = v115;
						v27 = v24 / v25;
						v28 = 0;
						v116 = Vector3.new;
						v29 = v116;
						v30 = v26;
						v31 = v27;
						v32 = v28;
						v117 = v29(v30, v31, v32);
						v118 = CFrame.new;
						v33 = v114;
						v34 = v117;
						v119 = v33 + v34;
						v35 = v118;
						v36 = v119;
						v120 = v35(v36);
						v121 = "CFrame";
						v37 = v110;
						v38 = v121;
						v39 = v120;
						v37[v38] = v39;
						v122 = l__BLOCK_SIZE__8;
						v40 = l__BLOCK_SIZE__8;
						v41 = v40;
						v42 = v105;
						v123 = v41 + v42;
						v124 = l__BLOCK_SIZE__8;
						v125 = Vector3.new;
						v43 = v125;
						v44 = v122;
						v45 = v123;
						v46 = v124;
						v126 = v43(v44, v45, v46);
						v127 = "Size";
						v47 = v110;
						v48 = v127;
						v49 = v126;
						v47[v48] = v49;
						v128 = true;
						v129 = "Anchored";
						v50 = v110;
						v51 = v129;
						v52 = v128;
						v50[v51] = v52;
						v130 = false;
						v131 = "CanCollide";
						v53 = v110;
						v54 = v131;
						v55 = v130;
						v53[v54] = v55;
						v132 = 1;
						v133 = "Transparency";
						v56 = v110;
						v57 = v133;
						v58 = v132;
						v56[v57] = v58;
						v134 = l__Workspace__4;
						v135 = "Parent";
						v59 = v110;
						v60 = v135;
						v61 = v134;
						v59[v60] = v61;
						v136 = u9;
						v137 = "Part";
						v62 = v110;
						v138 = v62;
						v63 = v136;
						v64 = v137;
						v65 = v138;
						v139 = v63(v64, v65);
						v140 = l__GameQueryUtil__10;
						v66 = v139;
						v141 = v66;
						v142 = "setQueryIgnored";
						v67 = v140;
						v143 = v67;
						v68 = v140;
						v69 = v142;
						v144 = v68[v69];
						v70 = v144;
						v71 = v143;
						v72 = v141;
						v70(v71, v72);
						v145 = u9;
						v146 = "SelectionBox";
						v147 = {};
						v148 = "Adornee";
						v73 = v147;
						v74 = v148;
						v75 = v139;
						v73[v74] = v75;
						v149 = "Parent";
						v76 = v147;
						v77 = v149;
						v78 = v139;
						v76[v77] = v78;
						v79 = Color3.fromRGB;
						v80 = 0;
						v81 = 0;
						v82 = 0;
						v83 = v79;
						v84 = v80;
						v85 = v81;
						v86 = v82;
						v150 = v83(v84, v85, v86);
						v151 = "Color3";
						v87 = v147;
						v88 = v151;
						v89 = v150;
						v87[v88] = v89;
						v152 = 0.04;
						v153 = "LineThickness";
						v90 = v147;
						v91 = v153;
						v92 = v152;
						v90[v91] = v92;
						v154 = 0;
						v155 = "Transparency";
						v93 = v147;
						v94 = v155;
						v95 = v154;
						v93[v94] = v95;
						v96 = v145;
						v97 = v146;
						v98 = v147;
						v96(v97, v98);
						v156 = u11;
						u14 = v139;
						v157 = function()
							u14:Destroy();
						end;
						v158 = "GiveTask";
						v99 = v156;
						v159 = v99;
						v100 = v156;
						v101 = v158;
						v160 = v100[v101];
						v102 = v160;
						v103 = v159;
						v104 = v157;
						v102(v103, v104);
						return;
					end;
				else
					v12 = p4;
					v13 = "onHighlight";
					v14 = v12;
					v15 = v13;
					v16 = v14[v15];
					v17 = v16;
					if v17 then
						p4.onHighlight(v10, l__blockPosition__9);
					end;
					v110 = {};
					v18 = l__PositionUtil__7;
					v111 = "convertToWorldPosition";
					v19 = v18;
					v20 = v111;
					v112 = v19[v20];
					v21 = l__blockPosition__9;
					v113 = v21;
					v22 = v112;
					v23 = v113;
					v114 = v22(v23);
					v26 = 0;
					v115 = 2;
					v24 = v105;
					v25 = v115;
					v27 = v24 / v25;
					v28 = 0;
					v116 = Vector3.new;
					v29 = v116;
					v30 = v26;
					v31 = v27;
					v32 = v28;
					v117 = v29(v30, v31, v32);
					v118 = CFrame.new;
					v33 = v114;
					v34 = v117;
					v119 = v33 + v34;
					v35 = v118;
					v36 = v119;
					v120 = v35(v36);
					v121 = "CFrame";
					v37 = v110;
					v38 = v121;
					v39 = v120;
					v37[v38] = v39;
					v122 = l__BLOCK_SIZE__8;
					v40 = l__BLOCK_SIZE__8;
					v41 = v40;
					v42 = v105;
					v123 = v41 + v42;
					v124 = l__BLOCK_SIZE__8;
					v125 = Vector3.new;
					v43 = v125;
					v44 = v122;
					v45 = v123;
					v46 = v124;
					v126 = v43(v44, v45, v46);
					v127 = "Size";
					v47 = v110;
					v48 = v127;
					v49 = v126;
					v47[v48] = v49;
					v128 = true;
					v129 = "Anchored";
					v50 = v110;
					v51 = v129;
					v52 = v128;
					v50[v51] = v52;
					v130 = false;
					v131 = "CanCollide";
					v53 = v110;
					v54 = v131;
					v55 = v130;
					v53[v54] = v55;
					v132 = 1;
					v133 = "Transparency";
					v56 = v110;
					v57 = v133;
					v58 = v132;
					v56[v57] = v58;
					v134 = l__Workspace__4;
					v135 = "Parent";
					v59 = v110;
					v60 = v135;
					v61 = v134;
					v59[v60] = v61;
					v136 = u9;
					v137 = "Part";
					v62 = v110;
					v138 = v62;
					v63 = v136;
					v64 = v137;
					v65 = v138;
					v139 = v63(v64, v65);
					v140 = l__GameQueryUtil__10;
					v66 = v139;
					v141 = v66;
					v142 = "setQueryIgnored";
					v67 = v140;
					v143 = v67;
					v68 = v140;
					v69 = v142;
					v144 = v68[v69];
					v70 = v144;
					v71 = v143;
					v72 = v141;
					v70(v71, v72);
					v145 = u9;
					v146 = "SelectionBox";
					v147 = {};
					v148 = "Adornee";
					v73 = v147;
					v74 = v148;
					v75 = v139;
					v73[v74] = v75;
					v149 = "Parent";
					v76 = v147;
					v77 = v149;
					v78 = v139;
					v76[v77] = v78;
					v79 = Color3.fromRGB;
					v80 = 0;
					v81 = 0;
					v82 = 0;
					v83 = v79;
					v84 = v80;
					v85 = v81;
					v86 = v82;
					v150 = v83(v84, v85, v86);
					v151 = "Color3";
					v87 = v147;
					v88 = v151;
					v89 = v150;
					v87[v88] = v89;
					v152 = 0.04;
					v153 = "LineThickness";
					v90 = v147;
					v91 = v153;
					v92 = v152;
					v90[v91] = v92;
					v154 = 0;
					v155 = "Transparency";
					v93 = v147;
					v94 = v155;
					v95 = v154;
					v93[v94] = v95;
					v96 = v145;
					v97 = v146;
					v98 = v147;
					v96(v97, v98);
					v156 = u11;
					u14 = v139;
					v157 = function()
						u14:Destroy();
					end;
					v158 = "GiveTask";
					v99 = v156;
					v159 = v99;
					v100 = v156;
					v101 = v158;
					v160 = v100[v101];
					v102 = v160;
					v103 = v159;
					v104 = v157;
					v102(v103, v104);
					return;
				end;
			end;
		elseif v8 and v8.placementPosition then
			if p4.allowHighlight and not p4.allowHighlight(nil, v8.placementPosition) then
				v5();
				return nil;
			end;
			if v8.placementPosition ~= u13 then
				v5();
				u13 = v8.placementPosition;
				u12 = nil;
				if p4.onHighlightEnded then
					u11:GiveTask(function()
						p4.onHighlightEnded();
					end);
				end;
				if p4.onHighlight then
					p4.onHighlight(nil, u13);
				end;
				local v161 = u9("Part", {
					CFrame = CFrame.new(l__BlockEngine__5:getWorldPosition(v8.placementPosition)), 
					Size = Vector3.new(l__BLOCK_SIZE__8, l__BLOCK_SIZE__8, l__BLOCK_SIZE__8), 
					Anchored = true, 
					CanCollide = false, 
					Transparency = 1, 
					Parent = l__Workspace__4
				});
				l__GameQueryUtil__10:setQueryIgnored(v161);
				u9("SelectionBox", {
					Adornee = v161, 
					Parent = v161, 
					Color3 = Color3.fromRGB(0, 0, 0), 
					LineThickness = 0.04, 
					Transparency = 0
				});
				u11:GiveTask(function()
					v161:Destroy();
				end);
				return;
			end;
		else
			v5();
		end;
	end);
	p4.maid:GiveTask(function()
		l__RunService__3:UnbindFromRenderStep(v6);
	end);
	p4.maid:GiveTask(u11);
end;
function v3.disable(p6)
	p6.maid:DoCleaning();
end;
function v3.setInputObject(p7, p8)
	p7.registeredInputObject = p8;
	local u15 = p8;
	p7.maid:GiveTask(function()
		u15 = nil;
	end);
end;
function v3.setAllowHighlight(p9, p10)
	p9.allowHighlight = p10;
end;
function v3.setOnHighlight(p11, p12)
	p11.onHighlight = p12;
end;
function v3.setOnHighlightEnded(p13, p14)
	p13.onHighlightEnded = p14;
end;
return {
	BlockHighlighter = v3
};
