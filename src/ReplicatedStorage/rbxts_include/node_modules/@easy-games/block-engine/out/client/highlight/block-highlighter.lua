-- Decompiled with the Synapse X Luau decompiler.

local v1 = _G[script];
local v2 = v1.import(script, v1.getModule(script, "@rbxts", "services"));
local v3 = setmetatable({}, {
	__tostring = function()
		return "BlockHighlighter";
	end
});
v3.__index = v3;
function v3.new(...)
	local v4 = setmetatable({}, v3);
	return v4:constructor(...) and v4;
end;
local u1 = v1.import(script, v1.getModule(script, "@rbxts", "maid").Maid);
function v3.constructor(p1, p2, p3)
	p1.clientManager = p2;
	p1.mode = p3;
	p1.maid = u1.new();
end;
local l__HttpService__2 = v2.HttpService;
local l__RunService__3 = v2.RunService;
local l__Workspace__4 = v2.Workspace;
local l__BlockEngine__5 = v1.import(script, script.Parent.Parent.Parent).BlockEngine;
local l__BlockSelectorMode__6 = v1.import(script, script.Parent.Parent, "select", "block-selector").BlockSelectorMode;
local l__PositionUtil__7 = v1.import(script, script.Parent.Parent.Parent, "shared", "lib", "position-util").PositionUtil;
local l__BLOCK_SIZE__8 = v1.import(script, script.Parent.Parent.Parent, "shared", "block", "block-constants").BLOCK_SIZE;
local u9 = v1.import(script, v1.getModule(script, "@rbxts", "make"));
local l__GameQueryUtil__10 = v1.import(script, v1.getModule(script, "@easy-games", "game-core").out).GameQueryUtil;
function v3.enable(p4)
	local u11 = u1.new();
	local u12 = nil;
	u11:DoCleaning();
	u11:GiveTask(function()
		if u12 then
			if p4.onHighlightEnded then
				u11:GiveTask(function()
					p4.onHighlightEnded();
				end);
			end;
			u12 = nil;
		end;
	end);
	local v5 = "block-place-highlight:" .. l__HttpService__2:GenerateGUID(false);
	local u13 = nil;
	l__RunService__3:BindToRenderStep(v5, Enum.RenderPriority.Last.Value, function(p5)
		local v6 = nil;
		if p4.registeredInputObject and l__Workspace__4.CurrentCamera then
			if p4.registeredInputObject.UserInputState ~= Enum.UserInputState.End then
				v6 = l__Workspace__4.CurrentCamera:ScreenPointToRay(p4.registeredInputObject.Position.X, p4.registeredInputObject.Position.Y);
			else
				p4.registeredInputObject = nil;
			end;
		end;
		local v7 = p4.clientManager:getBlockSelector():getMouseInfo(p4.mode, {
			ray = v6
		});
		if v7 and v7.target then
			local l__blockPosition__8 = v7.target.blockRef.blockPosition;
			local v9 = l__BlockEngine__5:getStore():getBlockAt(v7.target.blockRef.blockPosition);
			if p4.allowHighlight and not p4.allowHighlight(v9, l__blockPosition__8) then
				u11:DoCleaning();
				u11:GiveTask(function()
					if u12 then
						if p4.onHighlightEnded then
							u11:GiveTask(function()
								p4.onHighlightEnded();
							end);
						end;
						u12 = nil;
					end;
				end);
				return nil;
			end;
			local v10 = u12;
			if v10 ~= nil then
				v10 = v10.blockPosition;
			end;
			if v7.target.blockRef.blockPosition ~= v10 then
				local v11 = nil;
				local v12 = nil;
				local v13 = nil;
				local v14 = nil;
				local v15 = nil;
				local v16 = nil;
				local v17 = nil;
				local v18 = nil;
				local v19 = nil;
				local v20 = nil;
				local v21 = nil;
				local v22 = nil;
				local v23 = nil;
				local v24 = nil;
				local v25 = nil;
				local v26 = nil;
				local v27 = nil;
				local v28 = nil;
				local v29 = nil;
				local v30 = nil;
				local v31 = nil;
				local v32 = nil;
				local v33 = nil;
				local v34 = nil;
				local v35 = nil;
				local v36 = nil;
				local v37 = nil;
				local v38 = nil;
				local v39 = nil;
				local v40 = nil;
				local v41 = nil;
				local v42 = nil;
				local v43 = nil;
				local v44 = nil;
				local v45 = nil;
				local v46 = nil;
				local v47 = nil;
				local v48 = nil;
				local v49 = nil;
				local v50 = nil;
				local v51 = nil;
				local v52 = nil;
				local v53 = nil;
				local v54 = nil;
				local v55 = nil;
				local v56 = nil;
				local v57 = nil;
				local v58 = nil;
				local v59 = nil;
				local v60 = nil;
				local v61 = nil;
				local v62 = nil;
				local v63 = nil;
				local v64 = nil;
				local v65 = nil;
				local v66 = nil;
				local v67 = nil;
				local v68 = nil;
				local v69 = nil;
				local v70 = nil;
				local v71 = nil;
				local v72 = nil;
				local v73 = nil;
				local v74 = nil;
				local v75 = nil;
				local v76 = nil;
				local v77 = nil;
				local v78 = nil;
				local v79 = nil;
				local v80 = nil;
				local v81 = nil;
				local v82 = nil;
				local v83 = nil;
				local v84 = nil;
				local v85 = nil;
				local v86 = nil;
				local v87 = nil;
				local v88 = nil;
				local v89 = nil;
				local v90 = nil;
				local v91 = nil;
				local v92 = nil;
				local v93 = nil;
				local v94 = nil;
				local v95 = nil;
				local v96 = nil;
				local v97 = nil;
				local u14 = nil;
				local v98 = nil;
				local v99 = nil;
				local v100 = nil;
				local v101 = nil;
				local v102 = nil;
				local v103 = nil;
				u11:DoCleaning();
				u11:GiveTask(function()
					if u12 then
						if p4.onHighlightEnded then
							u11:GiveTask(function()
								p4.onHighlightEnded();
							end);
						end;
						u12 = nil;
					end;
				end);
				u12 = v7.target.blockRef;
				u13 = v7.target.blockRef.blockPosition;
				local v104 = 0;
				if v9 then
					local v105 = v9;
					if v105 ~= nil then
						v105 = v105.Name;
					end;
					local v106 = l__BlockEngine__5:getHandlerRegistry():getHandler(v105);
					if v106 ~= nil then
						v106 = v106:getBlockMeta();
					end;
					if p4.mode == l__BlockSelectorMode__6.PLACE then
						local v107 = v106;
						if v107 ~= nil then
							v107 = v107.denyPlaceOn;
						end;
						if v107 then
							return nil;
						else
							local v108 = v106;
							if v108 ~= nil then
								v108 = v108.raisedHeight;
							end;
							if v108 ~= nil then
								v104 = v106.raisedHeight;
							end;
							v11 = p4;
							v12 = "onHighlight";
							v13 = v11;
							v14 = v12;
							v15 = v13[v14];
							v16 = v15;
							if v16 then
								p4.onHighlight(v9, l__blockPosition__8);
							end;
							local v109 = {};
							v17 = l__PositionUtil__7;
							local v110 = "convertToWorldPosition";
							v18 = v17;
							v19 = v110;
							local v111 = v18[v19];
							v20 = l__blockPosition__8;
							local v112 = v20;
							v21 = v111;
							v22 = v112;
							local v113 = v21(v22);
							v25 = 0;
							local v114 = 2;
							v23 = v104;
							v24 = v114;
							v26 = v23 / v24;
							v27 = 0;
							local v115 = Vector3.new;
							v28 = v115;
							v29 = v25;
							v30 = v26;
							v31 = v27;
							local v116 = v28(v29, v30, v31);
							local v117 = CFrame.new;
							v32 = v113;
							v33 = v116;
							local v118 = v32 + v33;
							v34 = v117;
							v35 = v118;
							local v119 = v34(v35);
							local v120 = "CFrame";
							v36 = v109;
							v37 = v120;
							v38 = v119;
							v36[v37] = v38;
							local v121 = l__BLOCK_SIZE__8;
							v39 = l__BLOCK_SIZE__8;
							v40 = v39;
							v41 = v104;
							local v122 = v40 + v41;
							local v123 = l__BLOCK_SIZE__8;
							local v124 = Vector3.new;
							v42 = v124;
							v43 = v121;
							v44 = v122;
							v45 = v123;
							local v125 = v42(v43, v44, v45);
							local v126 = "Size";
							v46 = v109;
							v47 = v126;
							v48 = v125;
							v46[v47] = v48;
							local v127 = true;
							local v128 = "Anchored";
							v49 = v109;
							v50 = v128;
							v51 = v127;
							v49[v50] = v51;
							local v129 = false;
							local v130 = "CanCollide";
							v52 = v109;
							v53 = v130;
							v54 = v129;
							v52[v53] = v54;
							local v131 = 1;
							local v132 = "Transparency";
							v55 = v109;
							v56 = v132;
							v57 = v131;
							v55[v56] = v57;
							local v133 = l__Workspace__4;
							local v134 = "Parent";
							v58 = v109;
							v59 = v134;
							v60 = v133;
							v58[v59] = v60;
							local v135 = u9;
							local v136 = "Part";
							v61 = v109;
							local v137 = v61;
							v62 = v135;
							v63 = v136;
							v64 = v137;
							local v138 = v62(v63, v64);
							local v139 = l__GameQueryUtil__10;
							v65 = v138;
							local v140 = v65;
							local v141 = "setQueryIgnored";
							v66 = v139;
							local v142 = v66;
							v67 = v139;
							v68 = v141;
							local v143 = v67[v68];
							v69 = v143;
							v70 = v142;
							v71 = v140;
							v69(v70, v71);
							local v144 = u9;
							local v145 = "SelectionBox";
							local v146 = {};
							local v147 = "Adornee";
							v72 = v146;
							v73 = v147;
							v74 = v138;
							v72[v73] = v74;
							local v148 = "Parent";
							v75 = v146;
							v76 = v148;
							v77 = v138;
							v75[v76] = v77;
							v78 = Color3.fromRGB;
							v79 = 0;
							v80 = 0;
							v81 = 0;
							v82 = v78;
							v83 = v79;
							v84 = v80;
							v85 = v81;
							local v149 = v82(v83, v84, v85);
							local v150 = "Color3";
							v86 = v146;
							v87 = v150;
							v88 = v149;
							v86[v87] = v88;
							local v151 = 0.04;
							local v152 = "LineThickness";
							v89 = v146;
							v90 = v152;
							v91 = v151;
							v89[v90] = v91;
							local v153 = 0;
							local v154 = "Transparency";
							v92 = v146;
							v93 = v154;
							v94 = v153;
							v92[v93] = v94;
							v95 = v144;
							v96 = v145;
							v97 = v146;
							v95(v96, v97);
							local v155 = u11;
							u14 = v138;
							local v156 = function()
								u14:Destroy();
							end;
							local v157 = "GiveTask";
							v98 = v155;
							local v158 = v98;
							v99 = v155;
							v100 = v157;
							local v159 = v99[v100];
							v101 = v159;
							v102 = v158;
							v103 = v156;
							v101(v102, v103);
							return;
						end;
					else
						v108 = v106;
						if v108 ~= nil then
							v108 = v108.raisedHeight;
						end;
						if v108 ~= nil then
							v104 = v106.raisedHeight;
						end;
						v11 = p4;
						v12 = "onHighlight";
						v13 = v11;
						v14 = v12;
						v15 = v13[v14];
						v16 = v15;
						if v16 then
							p4.onHighlight(v9, l__blockPosition__8);
						end;
						v109 = {};
						v17 = l__PositionUtil__7;
						v110 = "convertToWorldPosition";
						v18 = v17;
						v19 = v110;
						v111 = v18[v19];
						v20 = l__blockPosition__8;
						v112 = v20;
						v21 = v111;
						v22 = v112;
						v113 = v21(v22);
						v25 = 0;
						v114 = 2;
						v23 = v104;
						v24 = v114;
						v26 = v23 / v24;
						v27 = 0;
						v115 = Vector3.new;
						v28 = v115;
						v29 = v25;
						v30 = v26;
						v31 = v27;
						v116 = v28(v29, v30, v31);
						v117 = CFrame.new;
						v32 = v113;
						v33 = v116;
						v118 = v32 + v33;
						v34 = v117;
						v35 = v118;
						v119 = v34(v35);
						v120 = "CFrame";
						v36 = v109;
						v37 = v120;
						v38 = v119;
						v36[v37] = v38;
						v121 = l__BLOCK_SIZE__8;
						v39 = l__BLOCK_SIZE__8;
						v40 = v39;
						v41 = v104;
						v122 = v40 + v41;
						v123 = l__BLOCK_SIZE__8;
						v124 = Vector3.new;
						v42 = v124;
						v43 = v121;
						v44 = v122;
						v45 = v123;
						v125 = v42(v43, v44, v45);
						v126 = "Size";
						v46 = v109;
						v47 = v126;
						v48 = v125;
						v46[v47] = v48;
						v127 = true;
						v128 = "Anchored";
						v49 = v109;
						v50 = v128;
						v51 = v127;
						v49[v50] = v51;
						v129 = false;
						v130 = "CanCollide";
						v52 = v109;
						v53 = v130;
						v54 = v129;
						v52[v53] = v54;
						v131 = 1;
						v132 = "Transparency";
						v55 = v109;
						v56 = v132;
						v57 = v131;
						v55[v56] = v57;
						v133 = l__Workspace__4;
						v134 = "Parent";
						v58 = v109;
						v59 = v134;
						v60 = v133;
						v58[v59] = v60;
						v135 = u9;
						v136 = "Part";
						v61 = v109;
						v137 = v61;
						v62 = v135;
						v63 = v136;
						v64 = v137;
						v138 = v62(v63, v64);
						v139 = l__GameQueryUtil__10;
						v65 = v138;
						v140 = v65;
						v141 = "setQueryIgnored";
						v66 = v139;
						v142 = v66;
						v67 = v139;
						v68 = v141;
						v143 = v67[v68];
						v69 = v143;
						v70 = v142;
						v71 = v140;
						v69(v70, v71);
						v144 = u9;
						v145 = "SelectionBox";
						v146 = {};
						v147 = "Adornee";
						v72 = v146;
						v73 = v147;
						v74 = v138;
						v72[v73] = v74;
						v148 = "Parent";
						v75 = v146;
						v76 = v148;
						v77 = v138;
						v75[v76] = v77;
						v78 = Color3.fromRGB;
						v79 = 0;
						v80 = 0;
						v81 = 0;
						v82 = v78;
						v83 = v79;
						v84 = v80;
						v85 = v81;
						v149 = v82(v83, v84, v85);
						v150 = "Color3";
						v86 = v146;
						v87 = v150;
						v88 = v149;
						v86[v87] = v88;
						v151 = 0.04;
						v152 = "LineThickness";
						v89 = v146;
						v90 = v152;
						v91 = v151;
						v89[v90] = v91;
						v153 = 0;
						v154 = "Transparency";
						v92 = v146;
						v93 = v154;
						v94 = v153;
						v92[v93] = v94;
						v95 = v144;
						v96 = v145;
						v97 = v146;
						v95(v96, v97);
						v155 = u11;
						u14 = v138;
						v156 = function()
							u14:Destroy();
						end;
						v157 = "GiveTask";
						v98 = v155;
						v158 = v98;
						v99 = v155;
						v100 = v157;
						v159 = v99[v100];
						v101 = v159;
						v102 = v158;
						v103 = v156;
						v101(v102, v103);
						return;
					end;
				else
					v11 = p4;
					v12 = "onHighlight";
					v13 = v11;
					v14 = v12;
					v15 = v13[v14];
					v16 = v15;
					if v16 then
						p4.onHighlight(v9, l__blockPosition__8);
					end;
					v109 = {};
					v17 = l__PositionUtil__7;
					v110 = "convertToWorldPosition";
					v18 = v17;
					v19 = v110;
					v111 = v18[v19];
					v20 = l__blockPosition__8;
					v112 = v20;
					v21 = v111;
					v22 = v112;
					v113 = v21(v22);
					v25 = 0;
					v114 = 2;
					v23 = v104;
					v24 = v114;
					v26 = v23 / v24;
					v27 = 0;
					v115 = Vector3.new;
					v28 = v115;
					v29 = v25;
					v30 = v26;
					v31 = v27;
					v116 = v28(v29, v30, v31);
					v117 = CFrame.new;
					v32 = v113;
					v33 = v116;
					v118 = v32 + v33;
					v34 = v117;
					v35 = v118;
					v119 = v34(v35);
					v120 = "CFrame";
					v36 = v109;
					v37 = v120;
					v38 = v119;
					v36[v37] = v38;
					v121 = l__BLOCK_SIZE__8;
					v39 = l__BLOCK_SIZE__8;
					v40 = v39;
					v41 = v104;
					v122 = v40 + v41;
					v123 = l__BLOCK_SIZE__8;
					v124 = Vector3.new;
					v42 = v124;
					v43 = v121;
					v44 = v122;
					v45 = v123;
					v125 = v42(v43, v44, v45);
					v126 = "Size";
					v46 = v109;
					v47 = v126;
					v48 = v125;
					v46[v47] = v48;
					v127 = true;
					v128 = "Anchored";
					v49 = v109;
					v50 = v128;
					v51 = v127;
					v49[v50] = v51;
					v129 = false;
					v130 = "CanCollide";
					v52 = v109;
					v53 = v130;
					v54 = v129;
					v52[v53] = v54;
					v131 = 1;
					v132 = "Transparency";
					v55 = v109;
					v56 = v132;
					v57 = v131;
					v55[v56] = v57;
					v133 = l__Workspace__4;
					v134 = "Parent";
					v58 = v109;
					v59 = v134;
					v60 = v133;
					v58[v59] = v60;
					v135 = u9;
					v136 = "Part";
					v61 = v109;
					v137 = v61;
					v62 = v135;
					v63 = v136;
					v64 = v137;
					v138 = v62(v63, v64);
					v139 = l__GameQueryUtil__10;
					v65 = v138;
					v140 = v65;
					v141 = "setQueryIgnored";
					v66 = v139;
					v142 = v66;
					v67 = v139;
					v68 = v141;
					v143 = v67[v68];
					v69 = v143;
					v70 = v142;
					v71 = v140;
					v69(v70, v71);
					v144 = u9;
					v145 = "SelectionBox";
					v146 = {};
					v147 = "Adornee";
					v72 = v146;
					v73 = v147;
					v74 = v138;
					v72[v73] = v74;
					v148 = "Parent";
					v75 = v146;
					v76 = v148;
					v77 = v138;
					v75[v76] = v77;
					v78 = Color3.fromRGB;
					v79 = 0;
					v80 = 0;
					v81 = 0;
					v82 = v78;
					v83 = v79;
					v84 = v80;
					v85 = v81;
					v149 = v82(v83, v84, v85);
					v150 = "Color3";
					v86 = v146;
					v87 = v150;
					v88 = v149;
					v86[v87] = v88;
					v151 = 0.04;
					v152 = "LineThickness";
					v89 = v146;
					v90 = v152;
					v91 = v151;
					v89[v90] = v91;
					v153 = 0;
					v154 = "Transparency";
					v92 = v146;
					v93 = v154;
					v94 = v153;
					v92[v93] = v94;
					v95 = v144;
					v96 = v145;
					v97 = v146;
					v95(v96, v97);
					v155 = u11;
					u14 = v138;
					v156 = function()
						u14:Destroy();
					end;
					v157 = "GiveTask";
					v98 = v155;
					v158 = v98;
					v99 = v155;
					v100 = v157;
					v159 = v99[v100];
					v101 = v159;
					v102 = v158;
					v103 = v156;
					v101(v102, v103);
					return;
				end;
			end;
		elseif v7 and v7.placementPosition then
			if p4.allowHighlight and not p4.allowHighlight(nil, v7.placementPosition) then
				u11:DoCleaning();
				u11:GiveTask(function()
					if u12 then
						if p4.onHighlightEnded then
							u11:GiveTask(function()
								p4.onHighlightEnded();
							end);
						end;
						u12 = nil;
					end;
				end);
				return nil;
			end;
			if v7.placementPosition ~= u13 then
				u11:DoCleaning();
				u11:GiveTask(function()
					if u12 then
						if p4.onHighlightEnded then
							u11:GiveTask(function()
								p4.onHighlightEnded();
							end);
						end;
						u12 = nil;
					end;
				end);
				u13 = v7.placementPosition;
				u12 = nil;
				if p4.onHighlightEnded then
					u11:GiveTask(function()
						p4.onHighlightEnded();
					end);
				end;
				if p4.onHighlight then
					p4.onHighlight(nil, u13);
				end;
				local v160 = u9("Part", {
					CFrame = CFrame.new(l__BlockEngine__5:getWorldPosition(v7.placementPosition)), 
					Size = Vector3.new(l__BLOCK_SIZE__8, l__BLOCK_SIZE__8, l__BLOCK_SIZE__8), 
					Anchored = true, 
					CanCollide = false, 
					Transparency = 1, 
					Parent = l__Workspace__4
				});
				l__GameQueryUtil__10:setQueryIgnored(v160);
				u9("SelectionBox", {
					Adornee = v160, 
					Parent = v160, 
					Color3 = Color3.fromRGB(0, 0, 0), 
					LineThickness = 0.04, 
					Transparency = 0
				});
				u11:GiveTask(function()
					v160:Destroy();
				end);
				return;
			end;
		else
			u11:DoCleaning();
			u11:GiveTask(function()
				if u12 then
					if p4.onHighlightEnded then
						u11:GiveTask(function()
							p4.onHighlightEnded();
						end);
					end;
					u12 = nil;
				end;
			end);
		end;
	end);
	p4.maid:GiveTask(function()
		l__RunService__3:UnbindFromRenderStep(v5);
	end);
	p4.maid:GiveTask(u11);
end;
function v3.disable(p6)
	p6.maid:DoCleaning();
end;
function v3.setInputObject(p7, p8)
	p7.registeredInputObject = p8;
	local u15 = p8;
	p7.maid:GiveTask(function()
		u15 = nil;
	end);
end;
function v3.setAllowHighlight(p9, p10)
	p9.allowHighlight = p10;
end;
function v3.setOnHighlight(p11, p12)
	p11.onHighlight = p12;
end;
function v3.setOnHighlightEnded(p13, p14)
	p13.onHighlightEnded = p14;
end;
return {
	BlockHighlighter = v3
};
